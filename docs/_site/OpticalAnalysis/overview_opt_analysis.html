<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>6.1. Overview: Optical Analysis &#8212; Frog 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=039e1c02" />
    <link rel="stylesheet" type="text/css" href="../_static/_static/css/s4defs-roles.css" />
    <script src="../_static/documentation_options.js?v=8d563738"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6.2. Optical Parameter" href="optical_parameter.html" />
    <link rel="prev" title="6. Optical Analysis" href="optical_analysis_index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <blockquote>
<div></div></blockquote>
<section id="overview-optical-analysis">
<span id="overview-opt-analysis-page"></span><h1><span class="section-number">6.1. </span>Overview: Optical Analysis<a class="headerlink" href="#overview-optical-analysis" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#scientific-reminder" id="id3">Scientific reminder:</a></p></li>
<li><p><a class="reference internal" href="#available-optical-property" id="id4">Available optical  property:</a></p></li>
<li><p><a class="reference internal" href="#overview-for-the-inputs" id="id5">Overview for the inputs:</a></p></li>
<li><p><a class="reference internal" href="#overview-of-the-procedure" id="id6">Overview of the procedure:</a></p></li>
</ul>
</nav>
<p>In <img class="math" src="../_images/math/64ce76395a21d936e0f8a927bf1facabfed5a750.png" alt="\texttt{FROG}"/>, many properties can be computed from the structure given by the MD simulation: density, molecular orientation… None of these properties required the electronic degree of freedom one the dynamics given. The ‘’optical properties’’ defined in <img class="math" src="../_images/math/64ce76395a21d936e0f8a927bf1facabfed5a750.png" alt="\texttt{FROG}"/> are the one which depend on the structure and the molecule electronic cloud.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here we do not say that these properties does not depend on the electronic degree of freedom since its impact the system’s dynamics. But once this dynamics is approach, calculation these property no longer involve electrons.</p>
</div>
<p>These properties are: the polarizaiblity, alpha and iota, and the first hyperpolarizability, beta and chi.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The litteral name are used along with the grec notation: in the code the litteral name are used instead of the grec one for numerical obvious reason.</p>
</div>
<section id="scientific-reminder">
<h2><a class="toc-backref" href="#id3" role="doc-backlink"><span class="section-number">6.1.1. </span>Scientific reminder:</a><a class="headerlink" href="#scientific-reminder" title="Link to this heading">¶</a></h2>
<p>Using a Taylor devellopment of a molecule dipole moment <img class="math" src="../_images/math/681156851d814ddb371edd908f9534844d682854.png" alt="\bold{p}"/> under an electrostatic field <img class="math" src="../_images/math/870ec4e2867a9c528fc229cd716b74d489e0e806.png" alt="\bold{E}"/>, the polarizability <img class="math" src="../_images/math/2f5aa019312e1bbc969deab8dca8b00f76025404.png" alt="\alpha"/>, the first hyperpolarizability <img class="math" src="../_images/math/7138dad9ac96835665b17f5817eacfcaa9b834c9.png" alt="\beta"/> (the first is dropped for simplicity) and the second hyperpolarizability <img class="math" src="../_images/math/34d137cf01c787ecda732761c3f95b0f65a6c3e9.png" alt="\gamma"/> can be expressed as:</p>
<div class="math">
<p><img src="../_images/math/b10d742b4f6718b5b0cfb9d6f90bac60dcb1ff53.png" alt="\bold{p} = \bold{p}_0 + \alpha : \bold{E} + \beta : \bold{E} \bold{E} + \gamma : \bold{E} \bold{E} \bold{E}"/></p>
</div><p>Where <img class="math" src="../_images/math/63190f5984b168f830455985c0dad64fcdbfa1f6.png" alt="\vec{p}_0"/> is the permament dipole moment of a molecule.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <img class="math" src="../_images/math/111325bf5f063cad57beaf6c3e9dca6d29534f40.png" alt="n \pi"/> and <img class="math" src="../_images/math/22b09fb36752a57b36cb51add446ab16bc46ed4b.png" alt="\epsilon_0"/> are dropped for simplicity.</p>
</div>
<p>Similary, when an electromagnetic field  <img class="math" src="../_images/math/3d6cdc93cebbdf22271582a3030dcb71d7df2464.png" alt="\bold{E}^\omega"/> at the frequency <img class="math" src="../_images/math/16cb1e006199f0853a2dc67ea814446a38beb54e.png" alt="\omega"/> is shine on a molecule, it induces a dipole moment at similar frequency <img class="math" src="../_images/math/5501e840cf5444291ca106c885e99476a4093966.png" alt="\bold{p}^\omega"/>:</p>
<div class="math">
<p><img src="../_images/math/4f5b079d60bc1b3959de07f1e0b4f8759d483b47.png" alt="\bold{p}^\omega = \alpha (\omega; \omega) : \bold{E}^\omega"/></p>
</div><p>Or, if the electromagnetic field is large enough to higher harmonics. The first non-linear order is called the Sacond Harmonic Generation (SHG) and is the historical main target of <img class="math" src="../_images/math/64ce76395a21d936e0f8a927bf1facabfed5a750.png" alt="\texttt{FROG}"/>. The induced dipole moment is at the double frequency <img class="math" src="../_images/math/b762159df0d9fa262b51fdd5f6da095a663be968.png" alt="\bold{p}^{2 \omega}"/>:</p>
<div class="math">
<p><img src="../_images/math/1f68c973b0dab5469a52610db0c92daa895be66f.png" alt="\bold{p}^{2 \omega} = \beta (2 \omega; \omega, \omega):  \bold{E}^\omega \bold{E}^\omega"/></p>
</div><p>Where ‘:’ denotes tensorial products between 3x3 matrix or 3x3x3 matrix with 3D vector:</p>
<div class="math">
<p><img src="../_images/math/d62d9716c787dcaa524d61b080412c77f833a87a.png" alt="\bold{p}^\omega_a = \sum_b \alpha_{ab} (\omega; \omega)  \bold{E}^\omega_b"/></p>
</div><div class="math">
<p><img src="../_images/math/378f595d482a0b6a6f17d1514df8ed2e82767e8b.png" alt="\bold{p}^{2 \omega}_a = \sum_{bc} \beta_{abc} (2 \omega; \omega, \omega) \bold{E}^\omega_b \bold{E}^\omega_c"/></p>
</div><p>The polarizability and hyperpolarizability tensor, <img class="math" src="../_images/math/2f5aa019312e1bbc969deab8dca8b00f76025404.png" alt="\alpha"/> and <img class="math" src="../_images/math/7138dad9ac96835665b17f5817eacfcaa9b834c9.png" alt="\beta"/>, are properties of a molecule: they depend on (virtual) electronic transition moment and electronic energy gap. As long as the electromagentic field does not influence the states of the matter (individual or collective behaviors), these tensors describe the individual response of a molecule for linear and SHG proceses.</p>
<p>These tensors are space dependent, and are usually expressed in the molecular frame. In the molecular frame, the tensor used are  <img class="math" src="../_images/math/2f5aa019312e1bbc969deab8dca8b00f76025404.png" alt="\alpha"/> and <img class="math" src="../_images/math/7138dad9ac96835665b17f5817eacfcaa9b834c9.png" alt="\beta"/>:</p>
<div class="math">
<p><img src="../_images/math/edde4d0e1c31e1272f2c9584320435a9a60484c1.png" alt="\bold{p}^\omega_\text{mol} = \alpha (\omega; \omega) : \bold{E}^\omega_\text{mol}"/></p>
</div><div class="math">
<p><img src="../_images/math/0367c801b60fbbd5b729f0e41a1e6e66625604ac.png" alt="\bold{p}^{2 \omega}_\text{mol} = \beta (2 \omega; \omega, \omega) : \bold{E}^\omega_\text{mol} \bold{E}^\omega_\text{mol}"/></p>
</div><p>In the laboratory frame, the tensor used are  <img class="math" src="../_images/math/d9913bb47f4f9558491a23b5a8abae8e78da12a6.png" alt="\iota"/> and <img class="math" src="../_images/math/52b130781cb6e2b47a5efb235ac1cb4162210d12.png" alt="\chi"/>, and depends on the molecule orientation:</p>
<div class="math">
<p><img src="../_images/math/e0c80d066075302bcae3850efad7af04ce91940d.png" alt="\bold{p}^\omega_\text{lab} = \iota (\omega; \omega) : \bold{E}^\omega_\text{lab}"/></p>
</div><div class="math">
<p><img src="../_images/math/b6ac41c57020d77c8c03fbc7af58b62cbdc4054e.png" alt="\bold{p}^{2 \omega}_\text{lab} = \chi (2 \omega; \omega, \omega) : \bold{E}^\omega_\text{lab} \bold{E}^\omega_\text{lab}"/></p>
</div><p>To go from one frame to another, the rotational matrix <img class="math" src="../_images/math/1ebe654cc7b8f2a0d8100aa5825cf2b9021adbbc.png" alt="R"/> is used:</p>
<div class="math">
<p><img src="../_images/math/d75bf8a9dfbb299035c9cfd09e91284a29de369f.png" alt="\bold{p}^\omega_\text{lab} = R: \bold{E}^\omega_\text{mol}"/></p>
</div><p>Using this rotational matrix, one can express the tensor in the molecular and laboratory frame, for instance:</p>
<div class="math">
<p><img src="../_images/math/449ef79ecfa68ff9ca2856333dbbe345c2206497.png" alt="\chi_{ijk} (\omega; \omega, \omega) = \sum_{abc} R_{ia} R_{jb} R_{kc} \beta_{abc} (2 \omega; \omega, \omega)"/></p>
</div><p>In a real condensed phase, the response of the whole system is the response of every molecule within the laboratory frame. Thus, the optical response of the system is sensitive to the molecule orientation, <img class="math" src="../_images/math/1ebe654cc7b8f2a0d8100aa5825cf2b9021adbbc.png" alt="R"/>, and the molecule individual optical property, <img class="math" src="../_images/math/2b64d44f157128235b84555d66063783b4760e2a.png" alt="\beta (2 \omega; \omega, \omega)"/>.</p>
<p>And here comes an important question: how to get the molecular orientation <strong>and</strong> the optical response in order to predict (non-linear) optical response of liquids.</p>
<blockquote>
<div><ul class="simple">
<li><p>Constant hyperpolarizability:</p></li>
</ul>
</div></blockquote>
<p>Let’s say that the hyperpolarizability tensor <img class="math" src="../_images/math/2b64d44f157128235b84555d66063783b4760e2a.png" alt="\beta (2 \omega; \omega, \omega)"/> is the same for every molecule in the liquid. It make some sens: the MD force field you use every days to describes the net bulk water dynamics does not depend on the molecule. In this case, the optical response depends soleny on the molecule orientation. Therefore, to achieve this one has to compute only once the hyperpolarizability tensor, for instance in the vacuum phase.</p>
<blockquote>
<div><ul class="simple">
<li><p>Environment effects:</p></li>
</ul>
</div></blockquote>
<p>However, it has been shown that the electrostatic environment can affect the individual hyperpolarizability tensor <img class="math" src="../_images/math/2b64d44f157128235b84555d66063783b4760e2a.png" alt="\beta (2 \omega; \omega, \omega)"/> of molecule, for instance water. The charge position or the permanent dipole moment is mainly not very dependent on the environment because they depend on core electrons, which is not the case for optical response. Especially for non-linear reponse properties which are dramatically impacted by the most delocalised electrons and which are the more susceptible to the external electrostatic field.</p>
<p>In one hand, there is the need to average over the many configuration of the liquid phase to get properly converged resultats. In the other hand, each molecule optical properties may depends on its local environment, which involves to compute for every molecule its electronic degree of freedom to get the  <img class="math" src="../_images/math/e54f04c2dca5920e483d0caeed04a1371d4155db.png" alt="\alpha (\omega; \omega)"/>,  <img class="math" src="../_images/math/2b64d44f157128235b84555d66063783b4760e2a.png" alt="\beta (2 \omega; \omega, \omega)"/> …</p>
<p>This is exactly the purpose of <img class="math" src="../_images/math/64ce76395a21d936e0f8a927bf1facabfed5a750.png" alt="\texttt{FROG}"/>: computing the optical properties of molecule in liquid phase at electrostatic emmebbeded quantum level.</p>
</section>
<section id="available-optical-property">
<h2><a class="toc-backref" href="#id4" role="doc-backlink"><span class="section-number">6.1.2. </span>Available optical  property:</a><a class="headerlink" href="#available-optical-property" title="Link to this heading">¶</a></h2>
<p>Today, for every Molecule Type, <img class="math" src="../_images/math/64ce76395a21d936e0f8a927bf1facabfed5a750.png" alt="\texttt{FROG}"/> can compute for every molecule the polarizability and the first hyperpolarizability. You may also compute the second hyperpolarizability with a bit of extra work – see <a class="reference internal" href="../Tutorials/tuto_gamma_calculation.html#tuto-gamma-calculation-page"><span class="std std-ref">the relative tutorial</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The internal energy or dipole moment can be also easely computed by Frog. It is not yet implemented since the actual users do not look at these variables, but if you do please contact us.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The effective field (or cavity field, or local felt electromagnetic field felt) is still under devellopment.</p>
</div>
<p>For the polarizability, use the diagram <a class="reference internal" href="../Diagram/diagram_list.html#autodoc-diagram-alpha"><span class="std std-ref">alpha</span></a> and <a class="reference internal" href="../Diagram/diagram_list.html#autodoc-diagram-iota"><span class="std std-ref">iota</span></a> for the polarizability in the molecular and laboratory frame respectively.</p>
<p>For the hyperpolarizability, use the diagram <a class="reference internal" href="../Diagram/diagram_list.html#autodoc-diagram-beta"><span class="std std-ref">beta</span></a> and <a class="reference internal" href="../Diagram/diagram_list.html#autodoc-diagram-chi"><span class="std std-ref">chi</span></a> for the polarizability in the molecular and laboratory frame respectively.</p>
<p>For all these optical property, you can use the same value for all the molecule, or compute the individual value at the QM level. If you are using electrostatic emmebbeded QM calculation, you may be interested by the electrostatic field generated by the environment in the molecule vinicity. To keep track of it, use the diagram <a class="reference internal" href="../Diagram/diagram_list.html#autodoc-diagram-electric-field"><span class="std std-ref">alpha</span></a>.</p>
</section>
<section id="overview-for-the-inputs">
<h2><a class="toc-backref" href="#id5" role="doc-backlink"><span class="section-number">6.1.3. </span>Overview for the inputs:</a><a class="headerlink" href="#overview-for-the-inputs" title="Link to this heading">¶</a></h2>
<p>For more complete exemples , see <a class="reference internal" href="../Tutorials/tuto_optical_analysis_overview.html#tuto-optical-analysis-overview-page"><span class="std std-ref">this first overview tutorial</span></a>, <a class="reference internal" href="../Tutorials/tuto_quadrupole_long.html#tuto-quadrupole-long-page"><span class="std std-ref">this one for a more complexe electrostatic emmbedding scheme</span></a> or <a class="reference internal" href="../Tutorials/tuto_gamma_calculation.html#tuto-gamma-calculation-page"><span class="std std-ref">this one for second hyperpolarizability calculation</span></a>.</p>
<p>To perform optical analysis, you shall define the relative diagram first. For instance, to perform polarizability and hyperpolarizability calculation, first declare the diagrams:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">L_diagram_analysis_to_perform</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;electric_field&#39;</span><span class="p">,</span> <span class="s1">&#39;Averaged&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="s1">&#39;PE&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;Averaged&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;iota&#39;</span><span class="p">,</span> <span class="s1">&#39;Averaged&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="s1">&#39;Averaged&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">35</span><span class="p">,</span> <span class="mi">35</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;Averaged&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">35</span><span class="p">,</span> <span class="mi">35</span><span class="p">]]</span>
                              <span class="p">]</span>
<span class="n">moleculetype</span><span class="o">.</span><span class="n">read_diagram_input</span><span class="p">(</span><span class="n">GP</span><span class="p">,</span> <span class="n">L_diagram_analysis_to_perform</span>
</pre></div>
</div>
<p>Then, the optical properties inputs are given using the function <span class="incremental">moleculetype.read_optic_properties_input</span>. This function has many options which are explained in different part of the documentation. Let’s focus on the major ones.</p>
<p>Since the polarizability and the hyperpolarizabilty have been required, <img class="math" src="../_images/math/64ce76395a21d936e0f8a927bf1facabfed5a750.png" alt="\texttt{FROG}"/> needs to know how they should be computed: using a reference value or by a QM calculation. In this example, let’s say that the molecular polarizability is set to a reference value, and the hyperpolarizability should be computed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">L_alpha_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">9.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">9.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">9.8</span><span class="p">]])</span>
<span class="n">moleculetype</span><span class="o">.</span><span class="n">read_optic_properties_input</span><span class="p">(</span><span class="n">GP</span><span class="p">,</span> <span class="n">alpha_calculation_style</span><span class="o">=</span><span class="s1">&#39;Fixed for all&#39;</span><span class="p">,</span> <span class="n">L_alpha_ref</span><span class="o">=</span><span class="n">L_alpha_ref</span><span class="p">,</span> <span class="n">beta_calculation_style</span><span class="o">=</span><span class="s1">&#39;QM&#39;</span><span class="p">,</span> <span class="n">L_beta_ref</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>The <span class="incremental">L_alpha_ref</span> is used to defined the <img class="math" src="../_images/math/2f5aa019312e1bbc969deab8dca8b00f76025404.png" alt="\alpha"/> of every molecule of this MT, the iota is obtained by the product of this molecular polarizability with the molecular orientation – see here for more details.</p>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>Rajouter une page avec les equations de passage d ecrites?</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Every molecule of this MT will have the same molecular polarizability, alpha. Therefore, the diagram relative to the alpha are diracs.</p>
</div>
<p>The hyperpolarizability are computed by QM calculation. Therefore, a lot more information should be given.</p>
<p>First, which molecule of this MT should computed. To choose which molecule should be QM-computed, you can use 2 inputs: where_to_run_QM and selection_tool. ADD HYPERLINK to complete doc. If <span class="incremental">where_to_run_QM = [‘All’]</span>, then all the molecule of this MT may undergo QM calculation. Which is maybe what you want, but can lead to <strong>a lot</strong> of calculation very quickly. Moreover, in many cases, the optical response of some molecule are more interesting then other. For instance, for interfaces you may want to perform the calculation of the molecule only at the interface. For instance, using a plane discretization: <span class="incremental">where_to_run_QM = [‘Plane_xy’, 100, [50, 62, 63, 64, 65]]</span>, here 100 bins are used to discretize the z-laboratory axis.  In this case, only molecule of this MT located at the bin 50, 62, 63, 64 or 65 in the z-laboratory axis are QM computed. The other do not contribute to the analysis.</p>
<p>Second, how the QM calculation are performed. <img class="math" src="../_images/math/64ce76395a21d936e0f8a927bf1facabfed5a750.png" alt="\texttt{FROG}"/> use the software <img class="math" src="../_images/math/bfbb549f164cd99497fd208261b9b26d457ce62e.png" alt="\texttt{DALTON}"/> to perform the QM calculation. To encode most of the information relative to the wat the QM calculation is performed, the object QMParameter is used ADD HYPERLINK. For this example, DFT framework is used with the Camb3lyp functional. For the basis set of the molecule, the d-aug-cc-pVTZ is used for all the atoms.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qmparameter</span> <span class="o">=</span> <span class="n">QMParameter</span><span class="p">()</span>

<span class="n">qmparameter</span><span class="o">.</span><span class="n">theory_lv</span> <span class="o">=</span> <span class="s1">&#39;DFT&#39;</span>
<span class="n">qmparameter</span><span class="o">.</span><span class="n">functional</span> <span class="o">=</span> <span class="s1">&#39;Camb3lyp&#39;</span>
<span class="n">qmparameter</span><span class="o">.</span><span class="n">type_basis</span> <span class="o">=</span> <span class="s1">&#39;Global basis&#39;</span>
<span class="n">qmparameter</span><span class="o">.</span><span class="n">global_basis_value</span> <span class="o">=</span> <span class="s1">&#39;d-aug-cc-pVTZ&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Today, only few of the available option of Dalton can be used. If you want to use other type of QM calculation, it may be very easy to implement in <img class="math" src="../_images/math/64ce76395a21d936e0f8a927bf1facabfed5a750.png" alt="\texttt{FROG}"/> as it can be just lines to write in <img class="math" src="../_images/math/bfbb549f164cd99497fd208261b9b26d457ce62e.png" alt="\texttt{DALTON}"/> input files.</p>
</div>
<p>With these parameters, <img class="math" src="../_images/math/bfbb549f164cd99497fd208261b9b26d457ce62e.png" alt="\texttt{DALTON}"/> can compute the electronic states of a molecule of this MT, but to compute the hyperpolarizability, it needs the frequency. Indeed, a powerfull tool of <img class="math" src="../_images/math/bfbb549f164cd99497fd208261b9b26d457ce62e.png" alt="\texttt{DALTON}"/> is to compute <strong>frequency-dependent</strong> polarizability and hyperpolarizabilities:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qmparameter</span><span class="o">.</span><span class="n">shg_response</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.05686</span><span class="p">]</span> <span class="c1"># should be given in a.u.,  0.05686 a.u. = 800nm, 0 a.u.= \infty nm</span>
</pre></div>
</div>
<p>In this case, the hyperpolarizabilities in the molecular and laboratory frame, <img class="math" src="../_images/math/7138dad9ac96835665b17f5817eacfcaa9b834c9.png" alt="\beta"/> and <img class="math" src="../_images/math/52b130781cb6e2b47a5efb235ac1cb4162210d12.png" alt="\chi"/>, are computed at 2 frequency: null and 0.05686 a.u. (which correspond to the infinite wave-length limite and 800~nm). In other words: <img class="math" src="../_images/math/8ee581d4a9e85dcb0566495459e456b4113a350f.png" alt="\beta(0.0; 0.0, 0.0)"/> and <img class="math" src="../_images/math/f198d08296eb75e3ad88d72644dc8323fe5d7ec9.png" alt="\beta( 0.11372;  0.05686,  0.05686)"/>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The diagrams with beta and chi are duplicated for every frequency. In this case, there will be the diagram beta_0.0, beta_0.05686, chi_0.0 and chi_0.05686.</p>
</div>
<p>Finaly, the way the environement should affect each molecule are defined using the qmparameter.calculation_style attribute ADD LINK. For this example, the electrostatic field generated by the neighborhood of a molecule up to a distance of 10 angstrom are included.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qmparameter</span><span class="o">.</span><span class="n">calculation_style</span> <span class="o">=</span> <span class="s1">&#39;PE&#39;</span>
<span class="n">qmparameter</span><span class="o">.</span><span class="n">pe_level</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">qmparameter</span><span class="o">.</span><span class="n">max_pe_distance_neigh</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
<p>To have a look of the obtained neighborhood, a file can be generated for every configuration using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qmparameter</span><span class="o">.</span><span class="n">write_xyz_environment</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Moreover, since an electrostatic analysis with the option ‘PE’ has been set in the diagram initialization, the electrostatic field generated by this neighborhood is saved. The electric_field_PE diagram contains the distribution of this electrostatic field felt by each molecule.</p>
</section>
<section id="overview-of-the-procedure">
<h2><a class="toc-backref" href="#id6" role="doc-backlink"><span class="section-number">6.1.4. </span>Overview of the procedure:</a><a class="headerlink" href="#overview-of-the-procedure" title="Link to this heading">¶</a></h2>
<p>Once the inputs read, <img class="math" src="../_images/math/64ce76395a21d936e0f8a927bf1facabfed5a750.png" alt="\texttt{FROG}"/> goes to the first part where all the structural properties are computed for individual molecules. If some of the optical property do not need QM calculation, there are calculated as well. For instance for chi calculation within the constant beta approximation: all the molecule have the same beta and the chi depends only on the molecule orientation.</p>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<p>rajouter le concept du prepare_QM_run en tant que fausse analyse? Peut etre plus loin mais pas dans cette page pcq c est vraiment du detail</p>
</div>
<p>If QM calculation is needed, the input are prepared during this first part. For every molecule which should be computed, the Dalton input are written: 3 files are needed.</p>
<blockquote>
<div><ul class="simple">
<li><p>dalton.dal: The file containing the main choices of the QM calculation such as the functional to use or the frequency at which compute the polarizability or hyperpolarizability. These information are for the majority fixed for all the molecule of a MT and are defined in the QMParameter object.</p></li>
<li><p>molecule.mol: The file containing the atoms of the QM box. This can be one molecule or several. In this file, the coordinates are written within the laboratory frame. This file contains also the basis set used.</p></li>
<li><p>potential.pot: The file containing the eletrostatic neigborhood around the QM box. The ‘sites’ located in this file can contains point charge, dipole or quadrupole moment. This electrostatic emmebedding can also be made dynamics by adding polarizabilities.</p></li>
</ul>
</div></blockquote>
<p>Once these input file written for all the configurations (<em>i.e.</em> each molecules across all the MTs that should undergo a QM calculation for every time step), the list of all the QM calculation to performed is created.</p>
<p>In the second part, <img class="math" src="../_images/math/64ce76395a21d936e0f8a927bf1facabfed5a750.png" alt="\texttt{FROG}"/> read this list of QM calculation to do, and create the submission script according to a template file. The generated files aims to submit thousands of calculation in a cluster. Then, <img class="math" src="../_images/math/64ce76395a21d936e0f8a927bf1facabfed5a750.png" alt="\texttt{FROG}"/> stops and it is up to you to launch the main submission script which launch all the calculations to the cluster.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>According to the first Frog author, submitting automatically jobs (and especially thousands) is a very bad behaviour and should always be done somehow manualy. Of course you may easily bypass this by runing automatically the main submission script after the end of <img class="math" src="../_images/math/64ce76395a21d936e0f8a927bf1facabfed5a750.png" alt="\texttt{FROG}"/> execution. You have been warned.</p>
</div>
<p>Once all the calculation done, you may re-run <img class="math" src="../_images/math/64ce76395a21d936e0f8a927bf1facabfed5a750.png" alt="\texttt{FROG}"/> with the option GP.pass_first_part = True ADD LINK. In this case, <img class="math" src="../_images/math/64ce76395a21d936e0f8a927bf1facabfed5a750.png" alt="\texttt{FROG}"/> will go directly to the second part, and update the QM calculation to perform. To do so, it will try to read every <img class="math" src="../_images/math/bfbb549f164cd99497fd208261b9b26d457ce62e.png" alt="\texttt{DALTON}"/> output files, all named dalton_molecule_potential.out, to check if the QM calculation have reached it final step.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><img class="math" src="../_images/math/64ce76395a21d936e0f8a927bf1facabfed5a750.png" alt="\texttt{FROG}"/> will not know if an error as been uncounter as long as the QM calculation reachs the last part. You may want to open by yourself several output file to check if everything is in order.</p>
</div>
<p>If <img class="math" src="../_images/math/64ce76395a21d936e0f8a927bf1facabfed5a750.png" alt="\texttt{FROG}"/> finds the output file, and if it consider that the QM calculation ended, this configuration is considerated as complete. This procedure is repeated for every QM calculation to do. If some calculations are not done (no output file) or are not finished (they may have crashed), <img class="math" src="../_images/math/64ce76395a21d936e0f8a927bf1facabfed5a750.png" alt="\texttt{FROG}"/> will recreate new set of subimission file to reperforme the QM calculation left to do. Until all the QM calculation are done, this loop of ‘second part -&gt; new set of submission script -&gt; QM run -&gt; second part’ has to be repeated.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this case, you really want to look at the file in the directory of one of these ‘crashed’ calculation. You will find the output file as well as the error that may occurs. If sometimes it can be due to cluster related problems (like RAM memory crashes…), you may have a patological case which requires more attention.</p>
</div>
<p>If all the QM calculation have been performed, the second part lead to the first part of <img class="math" src="../_images/math/64ce76395a21d936e0f8a927bf1facabfed5a750.png" alt="\texttt{FROG}"/>. In this part, the individual value of the optical properties which needed QM calculation are read from the <img class="math" src="../_images/math/bfbb549f164cd99497fd208261b9b26d457ce62e.png" alt="\texttt{DALTON}"/> outputs. Then, the diagram are update with the molecule’s value and the whole <img class="math" src="../_images/math/64ce76395a21d936e0f8a927bf1facabfed5a750.png" alt="\texttt{FROG}"/> procedure ends.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/frog_logo.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Installation/how_to_install_frog.html">1. How to Install Frog?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tutorials/tutorial_index.html">2. Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GlobalParameter/gp_index.html">3. Global Parameter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MoleculeType/mt_index.html">4. Molecule Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Diagram/diagram_index.html">5. Diagram</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="optical_analysis_index.html">6. Optical Analysis</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">6.1. Overview: Optical Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="optical_parameter.html">6.2. Optical Parameter</a></li>
<li class="toctree-l2"><a class="reference internal" href="electrostatic_embedding.html">6.3. Electrostatic embedding</a></li>
<li class="toctree-l2"><a class="reference internal" href="qm_box.html">6.4. QM box</a></li>
<li class="toctree-l2"><a class="reference internal" href="qm_management.html">6.5. QM Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="advices_for_qm.html">6.6. Some Advices for the QM</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Mathematics/mathematical_index.html">7. Mathematical and Numerical Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Frog.html">8. Frog package</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Guillaume Le Breton.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/OpticalAnalysis/overview_opt_analysis.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>