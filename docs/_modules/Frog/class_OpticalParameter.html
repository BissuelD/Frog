<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Frog.class_OpticalParameter &#8212; Frog 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=039e1c02" />
    <link rel="stylesheet" type="text/css" href="../../_static/_static/css/s4defs-roles.css" />
    <script src="../../_static/documentation_options.js?v=8d563738"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for Frog.class_OpticalParameter</h1><div class="highlight"><pre>
<span></span><span class="c1">##############################################################################</span>
<span class="c1">#                                                                            #</span>
<span class="c1">#    FROG: FROm molecular dynamics to second harmonic Generation             #</span>
<span class="c1">#    Copyright (C) 2024                                                      #</span>
<span class="c1">#    Author list                                                             #</span>
<span class="c1">#                                                                            #</span>
<span class="c1">#    Guillaume Le Breton                                                     #</span>
<span class="c1">#    Oriane Bonhomme                                                         #</span>
<span class="c1">#    Emmanuel Benichou                                                       #</span>
<span class="c1">#    Claire Loison                                                           #</span>
<span class="c1">#                                                                            # </span>
<span class="c1">#    This program is free software: you can redistribute it and/or modify    #</span>
<span class="c1">#    it under the terms of the GNU General Public License as published by    #</span>
<span class="c1">#    the Free Software Foundation, either version 3 of the License, or       #</span>
<span class="c1">#    (at your option) any later version.                                     #</span>
<span class="c1">#                                                                            #</span>
<span class="c1">#    This program is distributed in the hope that it will be useful,         #</span>
<span class="c1">#    but WITHOUT ANY WARRANTY; without even the implied warranty of          #</span>
<span class="c1">#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the           #</span>
<span class="c1">#    GNU General Public License for more details.                            #</span>
<span class="c1">#                                                                            #</span>
<span class="c1">#    You should have received a copy of the GNU General Public License       # </span>
<span class="c1">#    along with this program.  If not, see &lt;https://www.gnu.org/licenses/    #</span>
<span class="c1">#                                                                            #</span>
<span class="c1">##############################################################################</span>

<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">os</span> 
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">Frog.toolbox</span> <span class="k">as</span> <span class="nn">toolbox</span>
<span class="kn">import</span> <span class="nn">Frog.messages</span> <span class="k">as</span> <span class="nn">messages</span>
<span class="kn">import</span> <span class="nn">Frog.error_messages</span> <span class="k">as</span> <span class="nn">error_messages</span>
<span class="kn">from</span> <span class="nn">Frog.error_messages</span> <span class="kn">import</span> <span class="n">NotAnOptionError</span>

<span class="kn">import</span> <span class="nn">Frog.geometry_manager</span> <span class="k">as</span> <span class="nn">geometry_manager</span>
<span class="kn">import</span> <span class="nn">Frog.class_modules</span> <span class="k">as</span> <span class="nn">class_modules</span>

<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>

<div class="viewcode-block" id="OpticalParameter">
<a class="viewcode-back" href="../../Frog.html#Frog.class_OpticalParameter.OpticalParameter">[docs]</a>
<span class="k">class</span> <span class="nc">OpticalParameter</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters associated with &#39;optical&#39; properties which may require QM calculation. The OpticalParameter holds general information about the molecule of this MT regarding what has to be performed or not. The information of how one QM calculation should be performed is contain in the qmparameter object. </span>
<span class="sd">        </span>
<span class="sd">        Note of developers: The efparameter are the information about the effective field calculation. Once, this implementation has been tried in Frog but not successfull. Yet, the code related to this part has not been removed as it could be use as a basis for futur development. However, if you want to start from scrach, do not hesitate and remove whatever is not used! </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;compute_electric_field_PE&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha_calculation_style&#39;</span><span class="p">,</span> <span class="s1">&#39;L_alpha_ref&#39;</span><span class="p">,</span> <span class="s1">&#39;beta_calculation_style&#39;</span><span class="p">,</span><span class="s1">&#39;L_beta_ref&#39;</span><span class="p">,</span> <span class="s1">&#39;beta_order&#39;</span><span class="p">,</span> <span class="s1">&#39;effective_field_on_beta&#39;</span><span class="p">,</span> <span class="s1">&#39;efparameter&#39;</span><span class="p">,</span> <span class="s1">&#39;where_to_run_QM&#39;</span><span class="p">,</span> <span class="s1">&#39;selection_tool&#39;</span><span class="p">,</span> <span class="s1">&#39;L_molecule_tracked&#39;</span><span class="p">,</span> <span class="s1">&#39;qmparameter&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_run_QM&#39;</span><span class="p">,</span> <span class="s1">&#39;L_QM_todo&#39;</span><span class="p">,</span> <span class="s1">&#39;pe_level&#39;</span><span class="p">]</span>
        
        <span class="c1"># default properties:</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">compute_electric_field_PE</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha_calculation_style</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_alpha_ref</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">L_beta_ref</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta_calculation_style</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta_order</span> <span class="o">=</span> <span class="s1">&#39;dipole&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">effective_field_on_beta</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">efparameter</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">where_to_run_QM</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection_tool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_molecule_tracked</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">qmparameter</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">IS_run_QM</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_QM_todo</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">pe_level</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        
        <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Prevent the attribution of undefine object to the class. This help avoiding bad spelling mistakes.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">NotAnOptionError</span><span class="p">(</span><span class="s1">&#39;The name </span><span class="si">%r</span><span class="s1"> is not a valide attribute for the OpticalParameter object.&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">NotAnOptionError</span><span class="p">(</span><span class="s1">&#39;The name </span><span class="si">%r</span><span class="s1"> is not a valide attribute for the OpticalParameter object.&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>

            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        
 <span class="c1">#################################################################################################################################         </span>
<span class="c1">#################################################################################################################################  </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">compute_electric_field_PE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [bool]  </span>
<span class="sd">        </span>
<span class="sd">        Set to True of there are diagrams defined which track the electrostatic field generated by the environment during the QM calculation. Originaly related to the option &#39;PE&#39; of an electric_field analysis. </span>
<span class="sd">        </span>
<span class="sd">        If set to False, default, the electric field generated by the environement for each configuration is not computed by Frog nor store. But Dalton will still do it during the QM calculation. </span>
<span class="sd">        </span>
<span class="sd">        Not user defined</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_compute_electric_field_PE</span><span class="p">)</span>
    
    <span class="nd">@compute_electric_field_PE</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">compute_electric_field_PE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute OpticalParameter.compute_electric_field_PE values can only be bool.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the OpticalParameter.compute_electric_field_PE  name to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_compute_electric_field_PE</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">#################################################################################################################################          </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">alpha_calculation_style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [bool or str]  </span>
<span class="sd">        </span>
<span class="sd">        If no analysis (*i.e.* diagram) declared are of type alpha or iota, the alpha_calculation_style have to be False, default value. Otherwise the run will crash. In the same way, if you have declared an alpha or iota analysis, you have to set alpha_calculation_style to one of the possible value:</span>
<span class="sd">        </span>
<span class="sd">            + &#39;Fixed for all&#39;: </span>
<span class="sd">        </span>
<span class="sd">        The alpha tensor is given by the attribute OpticalParameter.L_alpha_ref . In this case, the polarizability in the molecular frame is fixed and equal to this value. The polarizability in the laboratory frame is given by the molecule orientation: it is a product of this OpticalParameter.L_alpha_ref with the SingleMolecule.rot_mat using the function: L_iota = Frog.toolbox.rotate_2nd_order_tensor(SingleMolecule.rot_mat.T, OpticalParameter.L_alpha_ref). Note that the rotational matrix,  SingleMolecule.rot_mat is given by the molecular library file function Frog.Molecules.my_MT.compute_rotational_matrix .</span>
<span class="sd">        </span>
<span class="sd">            + &#39;QM&#39;:</span>
<span class="sd">        </span>
<span class="sd">        The polarizability is computed for each molecule selected, see the OpticalParameter.where_to_run_QM and OpticalParameter.selection_tool attributes, at the QM level. The polarizablity is computed using the parameters provided in the OpticalParameter.qmparameter object. For a single molecule, the polarizability in the laboratory frame is computed (iota), and the alpha is obtained using the molecule orientation: L_alpha = toolbox.rotate_2nd_order_tensor(SingleMolecule.rot_mat, L_iota) .</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        In your input parameter file, declare the OpticalParameter.alpha_calculation_style value using: :: </span>
<span class="sd">        </span>
<span class="sd">            myMT.read_optic_properties_input(GP, ...,  alpha_calculation_style=your_value, ...)</span>
<span class="sd">        </span>
<span class="sd">        where the &#39;...&#39; stands for the other parameter you may need to use. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        No &#39;iota_calculation_style&#39; has been defined since the alpha and iota are related by the molecule orientation. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_alpha_calculation_style</span><span class="p">)</span>
    
    <span class="nd">@alpha_calculation_style</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">alpha_calculation_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute OpticalParameter.alpha_calculation_style values can only be bool or str.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the OpticalParameter.alpha_calculation_style  name to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alpha_calculation_style</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">#################################################################################################################################         </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">L_alpha_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [bool or list]  </span>
<span class="sd">        </span>
<span class="sd">        If the OpticalParameter.alpha_calculation_style=&#39;Fixed for all&#39;, the  OpticalParameter.L_alpha_ref has to be set to a 3x3 list. This value is used to defined the polarizability of every molecule of this MT in their molecular frame.</span>
<span class="sd">        </span>
<span class="sd">        If OpticalParameter.alpha_calculation_style is set to any other value, OpticalParameter.L_alpha_ref should be False, its default value. </span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        In your input parameter file, declare the OpticalParameter.L_alpha_ref value using: :: </span>
<span class="sd">        </span>
<span class="sd">            myMT.read_optic_properties_input(GP, ...,  L_alpha_ref=your_value, ...)</span>
<span class="sd">        </span>
<span class="sd">        where the &#39;...&#39; stands for the other parameter you may need to use. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        The unit to declare the polarizability should be atomic unit. For instance, the polarizability of water at optical freuqnecy is around: L_alpha_ref = [[9.8, 0, 0,], [0, 9.8, 0], [0, 0, 9.8]]. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_L_alpha_ref</span><span class="p">)</span>
    
    <span class="nd">@L_alpha_ref</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">L_alpha_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute OpticalParameter.L_alpha_ref values can only be bool or list.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the OpticalParameter.L_alpha_ref  name to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_L_alpha_ref</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">#################################################################################################################################            </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">beta_calculation_style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [bool or str]  </span>
<span class="sd">        </span>
<span class="sd">        If no analysis (*i.e.* diagram) declared are of type beta or chi, the beta_calculation_style have to be False, default value. Otherwise the run will crash. In the same way, if you have declared a beta or chi analysis, you have to set beta_calculation_style to one of the possible value:</span>
<span class="sd">        </span>
<span class="sd">            + &#39;Fixed for all&#39;: </span>
<span class="sd">        </span>
<span class="sd">        The beta tensor is given by the attribute OpticalParameter.L_beta_ref . In this case, the hyperpolarizability in the molecular frame is fixed and equal to this value. The hyperpolarizability in the laboratory frame is given by the molecule orientation: it is a product of this OpticalParameter.L_beta_ref with the SingleMolecule.rot_mat using the function: L_chi = Frog.toolbox.rotate_3rd_order_tensor(SingleMolecule.rot_mat.T, OpticalParameter.L_beta_ref). Note that the rotational matrix,  SingleMolecule.rot_mat is given by the molecular library file function Frog.Molecules.my_MT.compute_rotational_matrix .</span>
<span class="sd">        </span>
<span class="sd">            + &#39;QM&#39;:</span>
<span class="sd">        </span>
<span class="sd">        The hyperpolarizability is computed for each molecule selected, see the OpticalParameter.where_to_run_QM and OpticalParameter.selection_tool attributes, at the QM level. The hyperpolarizablity is computed using the parameters provided in the OpticalParameter.qmparameter object. For a single molecule, the hyperpolarizability in the laboratory frame is computed (chi), and the beta is obtained using the molecule orientation: L_beta = toolbox.rotate_3rd_order_tensor(SingleMolecule.rot_mat, L_chi) .</span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        In your input parameter file, declare the OpticalParameter.beta_calculation_style value using: :: </span>
<span class="sd">        </span>
<span class="sd">            myMT.read_optic_properties_input(GP, ...,  beta_calculation_style=your_value, ...)</span>
<span class="sd">        </span>
<span class="sd">        where the &#39;...&#39; stands for the other parameter you may need to use. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        No &#39;chi_calculation_style&#39; has been defined since the beta and chi are related by the molecule orientation. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_beta_calculation_style</span><span class="p">)</span>
    
    <span class="nd">@beta_calculation_style</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">beta_calculation_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute OpticalParameter.beta_calculation_style values can only be bool or str.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the OpticalParameter.beta_calculation_style to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_beta_calculation_style</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">#################################################################################################################################     </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">beta_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [str]  </span>
<span class="sd">        </span>
<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        ONLY FOR beta_calculation_style = &#39;QM&#39;</span>
<span class="sd">        </span>
<span class="sd">        Define at which order you want to compute the first hyperpolarizability: </span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">            + &#39;dipole&#39;: </span>
<span class="sd">        </span>
<span class="sd">        Default value. Compute the first dipole-dipole hyperpolarizability. In other words: the induced dipole moment at frequency 2w through dipolar interaction with electromagnetic field at frequency w. (&lt;&lt;\mu; \mu, \mu&gt;&gt;)</span>
<span class="sd">        </span>
<span class="sd">            + &#39;quadrupole&#39;:</span>
<span class="sd">        </span>
<span class="sd">        Compute the first dipole-dipole hyperpolarizability and the quadrupole-dipole interaction. This will update the beta and chi diagram type name. For every diagram, 3 diagram are created: one with the original name (for instance beta_0.0056) which will contain the dipole-dipole first hyperpolarizability. Another with the induced dipole moment with a dipole and quadrupole interaction (&lt;&lt;\mu; \mu, Q&gt;&gt;). The name of this diagram is update using &#39;dq&#39; for dipole-quadrupole. Finally, a last diagram is created for the quadrupole induced by dipole interaction (&lt;&lt;Q; \mu, \mu&gt;&gt;). The name of this diagram is update using &#39;qd&#39; for dipole-quadrupole. </span>
<span class="sd">        </span>
<span class="sd">        The size of the dq and qd diagram is 3x3x3x3. The component ijkl is encoded in the diagram using 81 component: i*27+j*9+k*3+l. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        For the frequency symmetry and the convention, please read the documentation about the hyperpolarizability, ADD REF.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        In your input parameter file, declare the OpticalParameter.beta_order value using: :: </span>
<span class="sd">        </span>
<span class="sd">            myMT.read_optic_properties_input(GP, ...,  beta_order=your_value, ...)</span>
<span class="sd">        </span>
<span class="sd">        where the &#39;...&#39; stands for the other parameter you may need to use. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        No &#39;chi_order&#39; has been defined since the beta and chi are related by the molecule orientation. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_beta_order</span><span class="p">)</span>
    
    <span class="nd">@beta_order</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">beta_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute OpticalParameter.beta_order values can only be str.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the OpticalParameter.beta_order to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_beta_order</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">L_beta_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [bool or list]  </span>
<span class="sd">        </span>
<span class="sd">        If the OpticalParameter.beta_calculation_style=&#39;Fixed for all&#39;, the  OpticalParameter.L_beta_ref has to be set to a 3x3x3 list. This value is used to defined the hyperpolarizability of every molecule of this MT in their molecular frame.</span>
<span class="sd">        </span>
<span class="sd">        If OpticalParameter.alpha_calculation_style is set to any other value, OpticalParameter.L_beta_ref should be False, its default value. </span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        In your input parameter file, declare the OpticalParameter.L_beta_ref value using: :: </span>
<span class="sd">        </span>
<span class="sd">            myMT.read_optic_properties_input(GP, ...,  L_beta_ref=your_value, ...)</span>
<span class="sd">        </span>
<span class="sd">        where the &#39;...&#39; stands for the other parameter you may need to use. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        The unit to declare the hyperpolarizability should be atomic unit. For instance, the hyperpolarizability of water in vacuum at the DFT/CAMB3LYP level with basis d-aug-cpVTZ at 800~nm is: L_beta_ref = [[[0, 0, -12.4,], [0, 0, 0], [-12.4, 0, 0]], [[0, 0, 0,], [0, 0, -7.4], [0, -7.4, 0]], [[-12.5, 0, 0,], [0, -5.0, 0], [0, 0, -15.3]]. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_L_beta_ref</span><span class="p">)</span>
    
    <span class="nd">@L_beta_ref</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">L_beta_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute OpticalParameter.L_beta_ref values can only be bool or list.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the OpticalParameter.L_beta_ref to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_L_beta_ref</span> <span class="o">=</span> <span class="n">value</span>                 
<span class="c1">#################################################################################################################################          </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">where_to_run_QM</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [bool or list]  </span>
<span class="sd">        </span>
<span class="sd">        This attribute set a first set of selection to the molecule which should be QM-treated. Indeed, you may want to not perform for all the molecule of a MT QM calculations: it may be too much time-consuming for litle interest. Therefore, this attribute works very similary to the :ref:`DiagramParameter.special_selection&lt;autodoc_diagramparameter_special_selection&gt;`. Another selection can be added in top of this one usin the attribute OpticalParameter.selection_tool. The molecule that will be QM computed have to respect all the 3 attributes restrictions.</span>
<span class="sd">        </span>
<span class="sd">        The format of this attribute is very similar to the geometrical discretisation option when declaring a diagram. As an user, when declaring  list of diagram to performed, you can define this special geometrical selection using: :: </span>
<span class="sd">            </span>
<span class="sd">            myMT.read_optic_properties_input(GP, ...,  where_to_run_QM=where_to_run_QM)</span>
<span class="sd">            </span>
<span class="sd">        Here are the available values for `where_to_run_QM`:</span>
<span class="sd">        </span>
<span class="sd">           + `False` or `True`:</span>
<span class="sd">        </span>
<span class="sd">        No extra special selection is made. All the molecule of the MT may be QM treated. </span>
<span class="sd">        </span>
<span class="sd">        In this case, the OpticalParameter.where_to_run_QM attribute is set to [-1].</span>
<span class="sd">           </span>
<span class="sd">           + `[&#39;All&#39;]`: </span>
<span class="sd">        </span>
<span class="sd">        No extra special selection is made. All the molecule of the MT may be QM treated. </span>
<span class="sd">        </span>
<span class="sd">        In this case, the OpticalParameter.where_to_run_QM attribute is set to [-1].</span>
<span class="sd">            </span>
<span class="sd">           + `[&#39;Plane_ij&#39;, bin_number, list_of_bin]`: </span>
<span class="sd">        </span>
<span class="sd">        For each time step, the box is discretized along plane with the axis ij. bin_number number of bin is used. Every molecules are assigned to one of these bin according to there mean position. If this bin is within the list_of_bin, the molecule is QM treated.   </span>
<span class="sd">        </span>
<span class="sd">        In this case, the OpticalParameter.where_to_run_QM attribute is set to [axis where the space is decretize (0, 1 or 2), bin_number, list_of_bin]</span>
<span class="sd">        </span>
<span class="sd">            + `[&#39;Layer&#39;, nbr_layer, list_layer]`:</span>
<span class="sd">        </span>
<span class="sd">        For each time step, the molecule are assigned to a layer, using &#39;nbr_layer&#39; number of layer. If a molecule is in the layer number given by list_layer, it is QM-treated. </span>
<span class="sd">         </span>
<span class="sd">        In this case, the OpticalParameter.where_to_run_QM object is set to [10, 2*nbr_layer+1, list_layer]</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            myMT.read_optic_properties_input(GP, ...,  where_to_run_QM=[&#39;Plane_xy&#39;, 100, [60, 61, 62, 63, 64, 65, 66]], ...)</span>
<span class="sd">        </span>
<span class="sd">        where the &#39;...&#39; stands for the other parameter you may need to use. </span>
<span class="sd">        </span>
<span class="sd">        The box in discretize along the z axis using 100 bins. Only the molecule within the 60 to 66 bin are treated using QM. The other molecule will have a null value regarding the optical analysis based on QM calculation. For instance, if OpticalParameter.beta_calculation_style = &#39;QM&#39;, the molecule which does not respect the previous condition will have for beta and chi 3x3x3 matrices with only zero values.   </span>
<span class="sd">        </span>
<span class="sd">        Note that the list of authorized bin can be not continous. </span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        `where_to_run_QM = [&#39;Layer&#39;, 4, [-4, -3, 0, 1, 4]]`</span>
<span class="sd">        </span>
<span class="sd">        Here, nbr_layer = 4. A molecule can be assigned to the layer number 4, 3, 2 or 1 for the upper interface (the 1st is the closest to the bulk phase, the 4th the farthest), to -4, -3, -2, -1 for the lower interface (the -4 is the farest from the bulk phase) or to 0 for the molecule in the bulk-like phase. Only molecule with layer number -4, -3, 0, 1 or 4 will be QM-treated using Dalton. </span>
<span class="sd">        </span>
<span class="sd">        Note that the list of authorized layer can be not continous. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        This condition is made after the one regarding the diagram parameters -- given by DiagramParameter.special_selection .         </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        This selection does not affect the diagram space discretization. Keep just in mind that if a molecule does not respect the  OpticalParameter.where_to_run_QM  conditions, its optical value may be zeros. Therefore, the total diagram can contains molecules which are QM-treated, and other with zero values.  </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        For develloper: the concrete action of OpticalParameter.where_to_run_QM is made in geometry_manager.optparameter_where_to_run_QM_molecule. Use this function to update new option for this attribute. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_where_to_run_QM</span><span class="p">)</span>
    
    <span class="nd">@where_to_run_QM</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">where_to_run_QM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute OpticalParameter.where_to_run_QM values can only be bool or list.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the OpticalParameter.where_to_run_QM  name to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_where_to_run_QM</span> <span class="o">=</span> <span class="n">value</span>                 
<span class="c1">#################################################################################################################################          </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">selection_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [bool or list or str]  </span>
<span class="sd">        </span>
<span class="sd">        Defines another way of selecting the molecule of this MT which should be QM-treated. This method are very different from the one proposed in OpticalParameter.where_to_run_QM: they are not based on laboratory-based geometrical selection. Both selection, OpticalParameter.where_to_run_QM and OpticalParameter.selection_tool, can be used simultaneously to minimize the QM calculation time. </span>
<span class="sd">        </span>
<span class="sd">        Today, the option available in this attribute is small, but if you want to implement easy-to-use selection for the QM calculation, you may want to define them here.</span>
<span class="sd">        </span>
<span class="sd">        Possible value for OpticalParameter.selection_tool:</span>
<span class="sd">        </span>
<span class="sd">            + `False`:</span>
<span class="sd">        </span>
<span class="sd">        Default value, no extra selection is defined using this attribute. </span>
<span class="sd">        </span>
<span class="sd">        In this case, the OpticalParameter.selection_tool is set to False.</span>
<span class="sd">        </span>
<span class="sd">            + `[&#39;traking_molecules&#39;, list of the molecule]`:</span>
<span class="sd">        </span>
<span class="sd">        Only the molecule with there molecule number in the list provided as second argument are QM-treated. Note that the labbeling is the same as the one given in MoleculeType.where_are_molecules: it refers to the MD topology labelling. </span>
<span class="sd">        </span>
<span class="sd">        In this case, the pticalParameter.selection_tool is set to &#39;traking_molecules&#39;. The list of the authorised molecule os stored in OpticalParameter.L_molecule_tracked.</span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        ::</span>
<span class="sd">            </span>
<span class="sd">            traking_molecules = [&#39;traking_molecules&#39;, [1005, 1050]]</span>
<span class="sd">            myMT.read_optic_properties_input(GP, ...,  traking_molecules=traking_molecules, ...)</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        where the &#39;...&#39; stands for the other parameter you may need to use. In this case, only the molecule numbered 1005 and 1050 can be QM-treated for all the time step. It is not the 1005th and 1050th molecule of the MT, but the 1005th and 1050th molecule of the MD labbeling -- except when you have only one MT where the 2 labbeling are the same or if it is the first MT declared. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        For develloper: the concrete action of OpticalParameter.selection_tool is made in geometry_manager.optparameter_selection_tool_molecule. Use this function to update new option for this attribute. </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_selection_tool</span><span class="p">)</span>
    
    <span class="nd">@selection_tool</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">selection_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute OpticalParameter.selection_tool values can only be bool or list or str.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the OpticalParameter.selection_tool  name to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_tool</span> <span class="o">=</span> <span class="n">value</span>                 
<span class="c1">#################################################################################################################################          </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">L_molecule_tracked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [bool or list]  </span>
<span class="sd">        </span>
<span class="sd">        Contained the list of the autorised molecule by the OpticalParameter.selection_tool attribute. </span>
<span class="sd">        </span>
<span class="sd">        Note user defined.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_L_molecule_tracked</span><span class="p">)</span>
    
    <span class="nd">@L_molecule_tracked</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">L_molecule_tracked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute OpticalParameter.L_molecule_tracked values can only be bool or list.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the OpticalParameter.L_molecule_tracked  name to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_L_molecule_tracked</span> <span class="o">=</span> <span class="n">value</span>                 
<span class="c1">#################################################################################################################################          </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">qmparameter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [bool or QMParameter]  </span>
<span class="sd">        </span>
<span class="sd">        The QMParameter for this MT. This attribute has to be defined if one optical analysis required QM calculation. If no QM calculation is needed for this MT, should be set to False. See the part relating to this QMParameter class for more information about it.</span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        To set the QMParameter, initialize it first, then fill the required attribute. Enventualy set it to the OpticalProperty using the usual  read_optic_properties_input function: </span>
<span class="sd">        ::</span>
<span class="sd">            </span>
<span class="sd">            qmparameter = QMParameter() # empty object</span>
<span class="sd">            qmparameter.calculation_style = &#39;PE&#39; # example of attribute</span>
<span class="sd">            qmparameter.theory_lv = &#39;DFT&#39; # example of attribute</span>
<span class="sd">            myMT.read_optic_properties_input(GP, ...,  qmparameter=qmparameter, ...) # set it to the optparameter </span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_qmparameter</span><span class="p">)</span>
    
    <span class="nd">@qmparameter</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">qmparameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">QMParameter</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute OpticalParameter.qmparameter values can only be bool or QMParameter.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;The OpticalParameter.qmparameter have been changed.&#39;</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_qmparameter</span> <span class="o">=</span> <span class="n">value</span>  

<span class="c1">#################################################################################################################################        </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">IS_run_QM</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [bool]  </span>
<span class="sd">        </span>
<span class="sd">        True if there are QM calculation to perform, False otherwise.</span>
<span class="sd">        </span>
<span class="sd">        Not user defined</span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        Instead we can use the qmparameter to know if there is QM calculation or not for this optparameter. But we felt that it would be more readable/understanable this way. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_IS_run_QM</span><span class="p">)</span>
    
    <span class="nd">@IS_run_QM</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">IS_run_QM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute OpticalParameter.IS_run_QM values can only be bool or QMParameter.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the OpticalParameter.IS_run_QM  name to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_IS_run_QM</span> <span class="o">=</span> <span class="n">value</span>                 
<span class="c1">#################################################################################################################################         </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">L_QM_todo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [bool or list]  </span>
<span class="sd">        </span>
<span class="sd">        The list of the localisation of the QM calculation to perform for this MT at this time step. This list is built after the first part and is used as a starting point during the second part to built all the QM calculation to do.</span>
<span class="sd">        </span>
<span class="sd">        You can check by opening this list at a given time step that the dalton files are indeed written in the directories and that the molecule respect the OpticalParameter.where_to_run_QM and OpticalParameter.selection_tool requirements.</span>
<span class="sd">        </span>
<span class="sd">        If no QM calculation should be done for this MT, OpticalParameter.L_QM_todo is set to False. If there can be QM calculation but none have to be done (because the QM calculation have aloready been performed or if no molecule respect both OpticalParameter.where_to_run_QM and OpticalParameter.selection_tool requirements) for this time step, OpticalParameter.L_QM_todo = []</span>
<span class="sd">        </span>
<span class="sd">        Not user defined</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_L_QM_todo</span><span class="p">)</span>
    
    <span class="nd">@L_QM_todo</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">L_QM_todo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute OpticalParameter.L_QM_todo values can only be bool or list.&#39;</span><span class="p">)</span>
        <span class="c1"># logging.info(&#39;Setting the OpticalParameter.L_QM_todo  name to %s&#39;, value) # too much print otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_L_QM_todo</span> <span class="o">=</span> <span class="n">value</span>                 
<span class="c1">#################################################################################################################################                 </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pe_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [int]  </span>
<span class="sd">        </span>
<span class="sd">        The maximal PE level used for this MT. It should be the same as the one defined in the OpticalParameter.qmparameter in many cases. </span>
<span class="sd">        </span>
<span class="sd">        If no electrostatic environement have to be built, default value, OpticalParameter.pe_level = -1.</span>
<span class="sd">        </span>
<span class="sd">        Not user defined</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pe_level</span><span class="p">)</span>
    
    <span class="nd">@pe_level</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">pe_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute OpticalParameter.pe_level values can only be int.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the OpticalParameter.pe_level  name to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="c1"># too much print otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pe_level</span> <span class="o">=</span> <span class="n">value</span>   
<span class="c1">#################################################################################################################################        </span>
<span class="c1">#################################################################################################################################</span>

<div class="viewcode-block" id="OpticalParameter.read_optic_properties_input">
<a class="viewcode-back" href="../../Frog.html#Frog.class_OpticalParameter.OpticalParameter.read_optic_properties_input">[docs]</a>
    <span class="k">def</span> <span class="nf">read_optic_properties_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">GP</span><span class="p">,</span> <span class="n">alpha_calculation_style</span><span class="p">,</span> <span class="n">L_alpha_ref</span><span class="p">,</span> <span class="n">beta_calculation_style</span><span class="p">,</span> <span class="n">L_beta_ref</span><span class="p">,</span> <span class="n">beta_order</span><span class="p">,</span> <span class="n">effective_field_on_beta</span><span class="p">,</span> <span class="n">efparameter</span><span class="p">,</span> <span class="n">where_to_run_QM</span><span class="p">,</span> <span class="n">qmparameter</span><span class="p">,</span> <span class="n">selection_tool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialized the optical properties, including QM runs</span>
<span class="sd">        </span>
<span class="sd">        Short overlook at the possible input:</span>
<span class="sd">        - alpha_calculation_style: Can be: False, &#39;Fixed for all&#39; or  &#39;QM&#39;. False by default. </span>
<span class="sd">        - L_alpha_ref: Can be False or a 3x3 list. False by default.</span>
<span class="sd">        - beta_calculation_style: Can be: False, &#39;Fixed for all&#39; or &#39;QM&#39; . False by default. </span>
<span class="sd">        - L_beta_ref: Can be False or a 3x3x3 list. False by default.</span>
<span class="sd">        - beta_order: can be: &#39;dipole&#39; or &#39;quadrupole&#39;. &#39;dipole&#39; by default</span>
<span class="sd">        - effective_field_on_beta: Can be: False or True. False by default. </span>
<span class="sd">        - effective_field_frequency: Can be list or False. False by default.</span>
<span class="sd">        - effective_field_distance_neigh: Can be float or False. False by default.</span>
<span class="sd">        - where_to_run_QM: Can be: False or a list. False by default.</span>
<span class="sd">        - qmparameter: Can be: False or an qmparamter object. False by default.</span>
<span class="sd">        - selection_tool: Can be: False or &#39;traking_molecules&#39;. False by default.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#messages.user_frendly_24_a()</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">message_with_hashtag</span><span class="p">(</span><span class="mi">74</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Start reading the optical parameters&#39;</span><span class="p">)</span>
        <span class="c1"># Polarizability</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_alpha_ref</span> <span class="o">=</span> <span class="n">L_alpha_ref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha_calculation_style</span> <span class="o">=</span> <span class="n">alpha_calculation_style</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha_calculation_style</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_calculation_style</span><span class="p">:</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_25</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_calculation_style</span> <span class="o">==</span> <span class="s1">&#39;Fixed for all&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L_alpha_ref</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_26</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L_alpha_ref</span><span class="p">)</span>                             
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="n">e_107</span><span class="p">())</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_calculation_style</span> <span class="o">==</span> <span class="s1">&#39;QM&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">qmparameter</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>    
                <span class="n">GP</span><span class="o">.</span><span class="n">IS_run_QM</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IS_run_QM</span> <span class="o">=</span> <span class="kc">True</span> 
                <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_27</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L_alpha_ref</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                    <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_26</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L_alpha_ref</span><span class="p">)</span>        
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="n">e_108</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="n">e_109</span><span class="p">())</span>
            
        <span class="c1"># SHG    </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_beta_ref</span> <span class="o">=</span> <span class="n">L_beta_ref</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">beta_calculation_style</span> <span class="o">=</span> <span class="n">beta_calculation_style</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta_calculation_style</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_calculation_style</span><span class="p">:</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_28</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_calculation_style</span> <span class="o">==</span> <span class="s1">&#39;Fixed for all&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L_beta_ref</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_29</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>                              
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="n">e_110</span><span class="p">())</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_calculation_style</span> <span class="o">==</span> <span class="s1">&#39;QM&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">qmparameter</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>    
                <span class="n">GP</span><span class="o">.</span><span class="n">IS_run_QM</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IS_run_QM</span> <span class="o">=</span> <span class="kc">True</span> 
                <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_30</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L_beta_ref</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                    <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_29</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="n">e_111</span><span class="p">())</span>
            
            <span class="k">if</span> <span class="n">beta_order</span> <span class="o">==</span> <span class="s1">&#39;dipole&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">beta_order</span> <span class="o">=</span> <span class="n">beta_order</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The first hyperpolarizability is computed at the dipolar approximation (beta_order = &quot;dipole&quot;).&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">beta_order</span> <span class="o">==</span> <span class="s1">&#39;quadrupole&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">beta_order</span> <span class="o">=</span> <span class="n">beta_order</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The first hyperpolarizability is computed up to the quadrupolar order (beta_order = &quot;quadrupole&quot;). The different order are presented in differente beta and chi diagrams (check the name of these diagrams).&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: the value beta_order can only be &quot;dipole&quot; or &quot;quadrupole&quot;.&#39;</span><span class="p">)</span>
            <span class="n">qmparameter</span><span class="o">.</span><span class="n">beta_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_order</span> <span class="c1">#needed because the dalton_manager_module.generate_inp_dal only takes qmparameter, not the optparameter!</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="n">e_112</span><span class="p">())</span>    
        
        <span class="c1"># Update information relative to QM calculation and checks the qmparameter        </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IS_run_QM</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">where_to_run_QM</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">where_to_run_QM</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: since you asked to performed QM calculation, you should provide the location where the QM should be performed. See the documentation for exemple -- the &quot;where_to_run_QM&quot; input.&#39;</span><span class="p">)</span>
                
            <span class="c1"># Where should the QM run be performed?</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_31</span><span class="p">(</span><span class="n">where_to_run_QM</span><span class="p">)</span>               
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">where_to_run_QM</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="n">where_to_run_QM</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">where_to_run_QM</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> 
                <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_32</span><span class="p">()</span> 
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">where_to_run_QM</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">where_to_run_QM</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;All&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">where_to_run_QM</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> 
                    <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_32</span><span class="p">()</span>  
                <span class="k">elif</span> <span class="n">where_to_run_QM</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Plane_&#39;</span><span class="p">:</span>
                    <span class="n">nbr_bin_space</span> <span class="o">=</span> <span class="n">where_to_run_QM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">axis_of_interest</span><span class="p">,</span> <span class="n">direction_toprint</span><span class="p">,</span> <span class="n">slice_size</span> <span class="o">=</span> <span class="n">geometry_manager</span><span class="o">.</span><span class="n">init_plane_axis</span><span class="p">(</span><span class="n">where_to_run_QM</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">6</span><span class="p">:],</span> <span class="n">GP</span><span class="o">.</span><span class="n">box_size</span><span class="p">,</span> <span class="n">nbr_bin_space</span><span class="p">)</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">where_to_run_QM</span> <span class="o">=</span> <span class="p">[</span><span class="n">axis_of_interest</span><span class="p">,</span> <span class="n">nbr_bin_space</span><span class="p">,</span> <span class="n">where_to_run_QM</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
                    <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_33</span><span class="p">(</span><span class="n">direction_toprint</span><span class="p">,</span> <span class="n">nbr_bin_space</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">where_to_run_QM</span><span class="p">)</span>  
                <span class="k">elif</span> <span class="n">where_to_run_QM</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Layer&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">where_to_run_QM</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="n">where_to_run_QM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">where_to_run_QM</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="c1"># the code 10 refers to the usual shortcut for layer space discretization in Frog</span>
                    <span class="n">GP</span><span class="o">.</span><span class="n">IS_layer_selection</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">GP</span><span class="o">.</span><span class="n">layer_nbr_max</span> <span class="o">&lt;</span> <span class="n">where_to_run_QM</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">GP</span><span class="o">.</span><span class="n">layer_nbr_max</span> <span class="o">=</span> <span class="n">where_to_run_QM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="n">e_113</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: the where_to_run_QM can only be bool or a list!&#39;</span><span class="p">)</span>
                
            <span class="c1"># special selection tool</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">selection_tool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">selection_tool</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;traking_molecules&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">selection_tool</span> <span class="o">=</span> <span class="n">selection_tool</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">L_molecule_tracked</span> <span class="o">=</span> <span class="n">selection_tool</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;In top of other possible geometrical selctions, the software will only consider the molecule number: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L_molecule_tracked</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: the value given in the option input &quot;selection_tool&quot; is not known. Possible type: traking_molecules&#39;</span><span class="p">)</span>
            
            <span class="c1"># Check the qmparameter</span>
            <span class="n">qmparameter</span><span class="o">.</span><span class="n">check_input_qm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">GP</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qmparameter</span> <span class="o">=</span> <span class="n">qmparameter</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pe_level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmparameter</span><span class="o">.</span><span class="n">pe_level</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pe_level</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pe_level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmparameter</span><span class="o">.</span><span class="n">pe_level</span><span class="p">)</span>
                    
        <span class="c1"># Effective field parameters:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">effective_field_on_beta</span> <span class="o">=</span> <span class="n">effective_field_on_beta</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">efparameter</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You have set parameters for an effective field calculation.&#39;</span><span class="p">)</span>
            <span class="n">efparameter</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">GP</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">efparameter</span> <span class="o">=</span> <span class="n">efparameter</span>
                
        <span class="c1">#messages.user_frendly_24_b()</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">message_with_hashtag</span><span class="p">(</span><span class="mi">74</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;End reading the optical parameters&#39;</span><span class="p">)</span></div>
</div>

        
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
        
<div class="viewcode-block" id="EFParameter">
<a class="viewcode-back" href="../../Frog.html#Frog.class_OpticalParameter.EFParameter">[docs]</a>
<span class="k">class</span> <span class="nc">EFParameter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    NOT USED IN THE CURRENT IMPLEMENTATION</span>
<span class="sd">    </span>
<span class="sd">    Contains all the information to perform efective field (EF) calculation for this molecule type. This class have been defined in order to store the parameter of the effective field calcualtion at one place. </span>
<span class="sd">    </span>
<span class="sd">    Variable defined by the user: </span>
<span class="sd">    </span>
<span class="sd">        - max_iteration: [integer] Set the maximal number of iteration authorized for the self-consistancy part of the effective field calculation. Note that this parameter is global for all the molecule type and should be defined only once.</span>
<span class="sd">        - max_diff_norm: [float] Set the maximal relative evolution of the effective field matrix under which the self consistancy run is considerated converged. Note that this parameter is global for all the molecule type and should be defined only once.</span>
<span class="sd">        - frequency = [list or string] The frequency at which the effective calculation should be performed. Note that the default value is &#39;REF&#39;, meaning that a zero frequency. </span>
<span class="sd">        - max_distance_neigh = [float] The maximal distance to consider a neighbourg in a molecule environment for the effective field. Note that this value can depend on the molecule type. Setting this value to 0 will set the effective field of this molecule to unity. You may not initialized this value: in this case the value will be taken from the GP -- equal to the maximal distance set by at least one of the molecule type. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;max_iteration&#39;</span><span class="p">,</span> <span class="s1">&#39;max_diff_norm&#39;</span><span class="p">,</span> <span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="s1">&#39;max_distance_neigh&#39;</span><span class="p">]</span>
        
        <span class="c1"># global initialization:</span>
        <span class="k">for</span> <span class="n">nameattribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameattribute</span><span class="p">,</span> <span class="s1">&#39;NotProvided&#39;</span><span class="p">)</span>    
        
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;REF&#39;</span><span class="p">]</span>
        
<span class="c1">#################################################################################################################################        </span>
        
<div class="viewcode-block" id="EFParameter.check_input">
<a class="viewcode-back" href="../../Frog.html#Frog.class_OpticalParameter.EFParameter.check_input">[docs]</a>
    <span class="k">def</span> <span class="nf">check_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">optparameter</span><span class="p">,</span> <span class="n">GP</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check the effective field parameters and update some value to GP</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># If the effective field correction should be apply to the chi/beta tensor. </span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">optparameter</span><span class="o">.</span><span class="n">effective_field_on_beta</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="n">optparameter</span><span class="o">.</span><span class="n">effective_field_on_beta</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The effect of the effective field on the molecular hyperpolarizability will be taken into account.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;REF&#39;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The same effective field correction will be apply for every hyperpolarizability frequency since no specific frequency have been set asked for the effective field calculation.&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">L_to_add</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#check that the \omega and 2\omega frequency are calculated for meaningfull beta correction.</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)):</span>
                     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">):</span>
                        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">toadd_2omega</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">while</span> <span class="n">j</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">):</span>
                                <span class="n">j</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
                                <span class="n">toadd_2omega</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">j</span><span class="o">+=</span><span class="mi">1</span>
                        <span class="k">if</span> <span class="n">toadd_2omega</span><span class="p">:</span>
                            <span class="n">L_to_add</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
                                
                <span class="k">for</span> <span class="n">freq_to_add</span> <span class="ow">in</span> <span class="n">L_to_add</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">freq_to_add</span><span class="p">)</span>  
                    
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">optparameter</span><span class="o">.</span><span class="n">effective_field_on_beta</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">optparameter</span><span class="o">.</span><span class="n">effective_field_on_beta</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The effect of the effective field on the molecular hyperpolarizability will NOT be taken into account.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: input not understood! optparameter.effective_field_on_beta should be either True or False. You send:&#39;</span><span class="p">,</span> <span class="n">optparameter</span><span class="o">.</span><span class="n">effective_field_on_beta</span><span class="p">)</span>
        
        <span class="c1"># Print the frequency for the molecule type and  update the GP  </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">==</span> <span class="s1">&#39;REF&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No specific frequency has been set for this molecule type (&quot;REF&quot; frequency).&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The effective field effect for this molecule type will be computed at the frequencies: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: input do not understood! The given input for frequency was: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="s1">&#39;Please see the documentation&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">GP</span><span class="o">.</span><span class="n">ef_list_frequency</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">GP</span><span class="o">.</span><span class="n">ef_list_frequency</span> <span class="o">==</span> <span class="s1">&#39;NotProvided&#39;</span><span class="p">:</span>
            <span class="n">GP</span><span class="o">.</span><span class="n">ef_list_frequency</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">freq_todo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">freq_todo</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">GP</span><span class="o">.</span><span class="n">ef_list_frequency</span><span class="p">:</span>
                <span class="n">GP</span><span class="o">.</span><span class="n">ef_list_frequency</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">freq_todo</span><span class="p">)</span>     
            
        <span class="c1"># Print the max_iteration, max_diff_norm and update the GP</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_iteration</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The maximal iteration for the self consistant part of the effective calculation is set to be: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_iteration</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;. Note that if this value is define in other molecule type, the maximal value will be considerated.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">GP</span><span class="o">.</span><span class="n">ef_max_iter</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">GP</span><span class="o">.</span><span class="n">ef_max_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_iteration</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">GP</span><span class="o">.</span><span class="n">ef_max_iter</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_iteration</span><span class="p">,</span> <span class="n">GP</span><span class="o">.</span><span class="n">ef_max_iter</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No maximal number of self-consistant iteration for the effective field procedure has been defined in this molecule type.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_diff_norm</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The maximal difference for the norm of the effective field matrix is set to be: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_diff_norm</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;. If the difference in norm between 2 consecutive self-consistance value of the effective field is smaller then this value, the procedure will be considerated converged and thus stoped. Note that if this value is define in other molecule type, the minimal value will be considerated.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">GP</span><span class="o">.</span><span class="n">ef_max_diff_norm</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">GP</span><span class="o">.</span><span class="n">ef_max_diff_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_diff_norm</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">GP</span><span class="o">.</span><span class="n">ef_max_diff_norm</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_diff_norm</span><span class="p">,</span> <span class="n">GP</span><span class="o">.</span><span class="n">ef_max_diff_norm</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No minimal value for the relative difference in the effective field matrix during effective field procedure have been defined in this molecule type.&#39;</span><span class="p">)</span>
        
        <span class="c1"># Print the max_distance_neigh and update the GP</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_distance_neigh</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The maximal distance to built the neighbourhood for molecules of this molecule type during the effective field procedure is set to be: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_distance_neigh</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">GP</span><span class="o">.</span><span class="n">ef_max_distance_neigh</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">GP</span><span class="o">.</span><span class="n">ef_max_distance_neigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_distance_neigh</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">GP</span><span class="o">.</span><span class="n">ef_max_distance_neigh</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_distance_neigh</span><span class="p">,</span> <span class="n">GP</span><span class="o">.</span><span class="n">ef_max_distance_neigh</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No maximal distance to built the neighbourhood for molecules of this molecule type during the effective field procedure has been defined.&#39;</span><span class="p">)</span>     </div>
</div>

        
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>

<div class="viewcode-block" id="QMParameter">
<a class="viewcode-back" href="../../Frog.html#Frog.class_OpticalParameter.QMParameter">[docs]</a>
<span class="k">class</span> <span class="nc">QMParameter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Contains all the information to perform QM calculation for this molecule type. Many of them are directly link to Dalton variable. The rest for the environment building from the MD trajectory. Very important parameters are read from the molecular module of this molecule type. Please make sure that the nomenclature used by the MD simulation is the same as the one used in the molecular module.</span>
<span class="sd">    </span>
<span class="sd">    Recommendations: </span>
<span class="sd">    </span>
<span class="sd">        - We strongly advice to check the environment built by setting the variable write_xyz_environment to True. Many insights are provided when watching to the molecular conformation. Moreover, it may highlight issues -- for instance PBC ones if the MD box size is not large enough. </span>
<span class="sd">        - Read the Dalton inputs generated by the software and try to run one conformation before sending hundred of crashing code to the cluster. Take some time to read the (clear and insightfull!) Dalton documentation.  </span>
<span class="sd">        - Take some time to converge the basis set you are using with respect to the observable. Espcially if you are interested in SHG processes.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Variable defined by the user: </span>
<span class="sd">    </span>
<span class="sd">        - dalton_version : [float] giving the year or the version name. Default = 2020</span>
<span class="sd">        - calculation_style: [string] Set the type of environement for a molecule. Possible value: &#39;Vacuum&#39;, &#39;PE&#39;, &#39;PE + QM box&#39;. </span>
<span class="sd">            Vacuum means that the QM calculation will be performed assuming that the molecule has no environment -- gas phase like calculation.</span>
<span class="sd">        </span>
<span class="sd">            The PE means that the QM box will contains only the molecule, but the QM box is embedded in an electrostatic environment. The electrostatic environement is described classically.</span>
<span class="sd">        </span>
<span class="sd">            The PE + QM box means that the QM box may contains several molecules, and the QM box is embedded in an electrostatic environment. The electrostatic environement is described classically.</span>
<span class="sd">        </span>
<span class="sd">        - pe_level: [integer] -1 for vaccum, 0 for non polarizable environment (the charges of the environement are fixed), 1 for polarizable environment (the environement is polarizable). Please note that the &#39;1&#39; has not been tested yet.</span>
<span class="sd">        - max_pe_distance_neigh: [float] If QM calculation in an PE environement is set, define the maximal distance from the target molecule to find neighbourgs which participate to the electrostaic environment.  </span>
<span class="sd">        - max_pe_polarization_distance_neigh: TODO</span>
<span class="sd">        - max_qm_box_distance_neigh: [float] If QM calculation in an PE environement is set, define the maximal distance from the target molecule to find neighbourgs which participate to the electrostaic environment. </span>
<span class="sd">        - write_xyz_environment: [boolean] Set if the environment of the molecule used to creat the electrostatic environment should be printed. By default set to False. </span>
<span class="sd">        </span>
<span class="sd">        - theory_lv: [string] The theoretical scheme used to perform the QM calculation. Possible value: DFT.</span>
<span class="sd">        - functional: [string] If the theory_lv = DFT, set the functional for the QM calculation.</span>
<span class="sd">        - type_basis: [string] The way basis set are describing a molecule (for all the atom or per atom). Implemented: Global basis.</span>
<span class="sd">        - global_basis_value: [string] The Dalton basis set used to described all the atom of the molecule type. Please note that several basis set can be defined if several molecule type are used (one per molecule type).</span>
<span class="sd">        </span>
<span class="sd">        - polarizability_response: [list or boolean] Define if the first polarizability of the molecule should be calculated. By default, set to False. If the polarizability should be computed, the polarizability_response should be a list of the frequency it has to be computed (in atomic unit). Example: polarizability_response = [0.0, 0.05686] to compute the static polarizability (0 frequency) and the one at 800 nm (0.05686 frequency).</span>
<span class="sd">        - shg_response: [list or boolean] Define if the first hyperpolarizability of the molecule should be calculated. By default, set to False. If the hyperpolarizability should be computed, the polarizability_response should be a list of the fundamental frequency it has to be computed (in atomic unit). Example: polarizability_response = [0.0, 0.05686] to compute the static polarizability (0 frequency) and the one at 800 nm (0.05686 frequency).</span>
<span class="sd">        - beta_order = [str] &#39;dipole&#39; or &#39;quadrupole&#39;, see optparameter.beta_order for more details. </span>
<span class="sd">        - total_charge: [integer] The total charge of the molecule type. By default, all the molecule have a zero-charge. Can be positive or negative. Please note that if the &#39;PE + QM box&#39; calculation style is used.</span>
<span class="sd">        - static_electric_field: [list of float] If defined, set a global static electric field to the quantum box. </span>
<span class="sd">        </span>
<span class="sd">        - max_iter_scf: [integer] The maximal scf iteration for the ground state calculation. By default, set to 500.</span>
<span class="sd">        - restart: [boolean] Set if Dalton tries to restart from a previous results/data. Actually not implemented, by default set to False. </span>
<span class="sd">        </span>
<span class="sd">    </span>
<span class="sd">    Internal Variable:</span>
<span class="sd">    </span>
<span class="sd">    - RUN_*: [boolean] Intern variable used to write the dalton input file. </span>
<span class="sd">    - more_select_environment: [boolean or string]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute_th_lv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;calculation_style&#39;</span><span class="p">,</span> <span class="s1">&#39;theory_lv&#39;</span><span class="p">,</span> <span class="s1">&#39;functional&#39;</span><span class="p">,</span> <span class="s1">&#39;static_electric_field&#39;</span><span class="p">,</span> <span class="s1">&#39;static_electric_field_direction&#39;</span><span class="p">,</span> <span class="s1">&#39;pe_level&#39;</span><span class="p">,</span> <span class="s1">&#39;max_pe_distance_neigh&#39;</span><span class="p">,</span> <span class="s1">&#39;max_pe_polarization_distance_neigh&#39;</span><span class="p">,</span> <span class="s1">&#39;long_range_distance_switch&#39;</span><span class="p">,</span> <span class="s1">&#39;long_range_switch&#39;</span><span class="p">,</span> <span class="s1">&#39;effective_field_polarization&#39;</span> <span class="s1">&#39;max_qm_box_distance_neigh&#39;</span><span class="p">,</span> <span class="s1">&#39;rcut_PE_direct&#39;</span><span class="p">,</span> <span class="s1">&#39;rcut_PE_smoth&#39;</span><span class="p">,</span> <span class="s1">&#39;ewald_factor&#39;</span><span class="p">,</span> <span class="s1">&#39;PE_k_vector_range&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute_mol</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;type_basis&#39;</span><span class="p">,</span><span class="s1">&#39;global_basis_value&#39;</span><span class="p">,</span> <span class="s1">&#39;total_charge&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute_response</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;polarizability_response&#39;</span><span class="p">,</span><span class="s1">&#39;shg_response&#39;</span><span class="p">,</span> <span class="s1">&#39;beta_order&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute_dalton_variable</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;repetition&#39;</span><span class="p">,</span><span class="s1">&#39;dalton_version&#39;</span><span class="p">,</span><span class="s1">&#39;RUN_pe&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_properties&#39;</span><span class="p">,</span><span class="s1">&#39;RUN_integral&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_int_dipole&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_int_quadrupole&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_electric_field&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_response&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_polarization&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_shg&#39;</span><span class="p">,</span> <span class="s1">&#39;max_iter_scf&#39;</span><span class="p">,</span> <span class="s1">&#39;restart&#39;</span><span class="p">,</span> <span class="s1">&#39;write_xyz_environment&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute_th_lv</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute_mol</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute_response</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute_dalton_variable</span>
        
        
        <span class="c1"># global initialization:</span>
        <span class="k">for</span> <span class="n">nameattribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nameattribute</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RUN_&#39;</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameattribute</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>   
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameattribute</span><span class="p">,</span> <span class="s1">&#39;NotProvided&#39;</span><span class="p">)</span>    
        
        <span class="bp">self</span><span class="o">.</span><span class="n">polarizability_response</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shg_response</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta_order</span> <span class="o">=</span> <span class="s1">&#39;dipole&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dalton_version</span> <span class="o">=</span> <span class="mi">2020</span>

        <span class="c1"># some particular behaviour:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RUN_properties</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_charge</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_iter_scf</span> <span class="o">=</span> <span class="mi">500</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restart</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pe_level</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">effective_field_polarization</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">more_select_environment</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_xyz_environment</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Prevent the attribution of undefine object to the class. This help avoiding bad spelling mistakes.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">NotAnOptionError</span><span class="p">(</span><span class="s1">&#39;The name </span><span class="si">%r</span><span class="s1"> is not a valide attribute for the QMParameter object.&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">NotAnOptionError</span><span class="p">(</span><span class="s1">&#39;The name </span><span class="si">%r</span><span class="s1"> is not a valide attribute for the QMParameter object.&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>

            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<span class="c1">#################################################################################################################################         </span>
<span class="c1">#################################################################################################################################  </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">calculation_style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [str]  </span>
<span class="sd">        </span>
<span class="sd">        The type of electrostatic embedding for the QM calculation of this MT. </span>
<span class="sd">        </span>
<span class="sd">        3 types of embedding are available: &#39;Vacuum&#39;, &#39;PE&#39;, &#39;PE long&#39; and &#39;PE + QM&#39;.</span>
<span class="sd">            + &#39;Vacuum&#39; </span>
<span class="sd">            </span>
<span class="sd">        Depreciated, use &#39;PE&#39; with pe_level=-1 instead. </span>
<span class="sd">        </span>
<span class="sd">            + &#39;PE&#39;</span>
<span class="sd">        </span>
<span class="sd">        The electrostatic embedding scheme where each molecule are alone in their QM box -- monomere QM calculation. The order used to described the electrostatic neighborgs is set by QMParameter.pe_level. The neighborhood is built up to a distance given by QMParameter.max_pe_distance_neigh. </span>
<span class="sd">        </span>
<span class="sd">        If QMParameter.pe_level = 1, 3 areas are defined. If a neighborgs distance is less then QMParameter.max_pe_polarization_distance_neigh, this neighborgs is described using polarizability (and the other point charge, dipole ect...). After this distance, and until QMParameter.max_pe_distance_neigh, the neighborgs is described without polarizability. After QMParameter.max_pe_distance_neigh, the neighborgs does not contribute to the electrostatic environment of the target molecule.</span>
<span class="sd">        </span>
<span class="sd">        Important note: you may define larger QMParameter.max_pe_distance_neigh then the MD box size. In this case, FROG will increase the neighborhood by using the PBC defines in GP.env_authorised_pbc_condition. </span>
<span class="sd">        </span>
<span class="sd">            + &#39;PE long&#39;</span>
<span class="sd">        </span>
<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        In the current version, this method is no longer available. It has been replace by &#39;PE&#39; with qmparameter.long_range_distance_switch attribute.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        The long-range electrostatic embedding scheme where each molecule are alone in their QM box -- monomere QM calculation.</span>
<span class="sd">        </span>
<span class="sd">        In this case, all the molecule in the MD box contributes to the electrostatic environment. If there are within a distance of QMParameter.rcut_PE_direct, they contribute &#39;directly&#39;. Each neighbors are added in the potential dalton file and thus produce an **heterogenous** electric field within the QM box vinicity. For the molecule in the box but futher away, the electrostatic field generated by them at the &#39;mean position&#39; of the target molecule is computed. All of these &#39;long-range&#39; contribution are summed up and affects the QM calculation by adding an **homogenous** electrostatic field. </span>
<span class="sd">        </span>
<span class="sd">        In top of these &#39;long-range&#39; contribution of molecule in the box, periodic copy of the MD box are created using the QMParameter.PE_k_vector_range attribute. All the molecule, including the copies of the target one, contributes to the &#39;long-range&#39; electrostatic field. This is done in the same spirit as long-range intermolecular interaction calculation in MD calculation, but without using the fourier space.  </span>
<span class="sd">        </span>
<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        The order used to described the electrostatic neighborgs SHALL BE QMParameter.pe_level=0. Note because there is important argument against, but because it has not been tested yet. </span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        The QMParameter.rcut_PE_direct has to be smaller then the MD box size! </span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Like in MD, you can use the QMParameter.rcut_PE_smoth and QMParameter.ewald_factor to creat a third area where the molecule contribute both to the direct and long-range part. Note that this functionality has not been widely tested. </span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">            + &#39;PE + QM&#39;</span>
<span class="sd">        </span>
<span class="sd">        The electrostatic embedding scheme where the target molecule may be not alone in their QM box. </span>
<span class="sd">        </span>
<span class="sd">        The neighborgs that are closer then QMParameter.max_qm_box_distance_neigh are added to the QM box. This mean that the QM calculation will have more atoms are more electrons. </span>
<span class="sd">        </span>
<span class="sd">        Let&#39;s say that the target molecule is Water, and that an Ethanol is added to the QM box. Questions arise if the parameter used to described the electronic part of one molecule is not the same as the other. For instance, if different basis are used, or different functional ect.. To deal with this problem, the GP.preference_functional can be used.  </span>
<span class="sd">        </span>
<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        This &#39;PE + QM&#39; option has not been extensively tested. </span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        If you are looking for a vacuum-like QM calculation, use QMParameter.calculation_style = &#39;PE&#39; along with QMParameter.pe_level = -1.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_calculation_style</span><span class="p">)</span>
    
    <span class="nd">@calculation_style</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">calculation_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.calculation_style can only be string.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.calculation_style  name to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_calculation_style</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dalton_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [float]</span>
<span class="sd">        Set the Dalton version, typically the year of release (2018, 2020, ..) with some under-version numbers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dalton_version</span><span class="p">)</span>
    
    <span class="nd">@dalton_version</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dalton_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.dalton_version can only be int or float&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.dalton_version  name to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dalton_version</span> <span class="o">=</span> <span class="n">value</span>

<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pe_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [int]  </span>
<span class="sd">        </span>
<span class="sd">        Set the Polarizable Environment of the neighborhood. </span>
<span class="sd">        </span>
<span class="sd">            + pe_level = -1: Vacuum</span>
<span class="sd">        </span>
<span class="sd">        No contribution of the neigborgs. </span>
<span class="sd">            </span>
<span class="sd">            + pe_level = 0: static neighborgs</span>
<span class="sd">        </span>
<span class="sd">        The neighborgs are described using point charge and/or dipole and/or quadrupole, as defined in their molecular library file. No polarizability.</span>
<span class="sd">        </span>
<span class="sd">            + pe_level = 1: polarizability</span>
<span class="sd">        </span>
<span class="sd">        The neighborgs are described using point charge and/or dipole and/or quadrupole, as defined in their molecular library file, and mayby a polarizability. This means that the permanent dipole can be created at the neighborgs localization depending on the total neighborhood. </span>
<span class="sd">        </span>
<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        If the QMParameter.calculation_style = &#39;PE long&#39;, QMParameter.pe_level SHALL BE 0. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        The pe_level = 1 has not been extensively tested. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pe_level</span><span class="p">)</span>
    
    <span class="nd">@pe_level</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">pe_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.pe_level can only be int.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.pe_level  name to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_pe_level</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">max_pe_distance_neigh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [float]  </span>
<span class="sd">        </span>
<span class="sd">        Parameter meaningfull only for QMParameter.calculation_style = &#39;PE&#39; or &#39;PE + QM&#39;. For &#39;PE long&#39;, use QMParameter.rcut_PE_direct instead. </span>
<span class="sd">        </span>
<span class="sd">        If QMParameter.pe_level = 0 or 1, set the maximal distance to add an electrostatic neighborgs. The neighbors is add without polarizabilities. </span>
<span class="sd">        </span>
<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        QMParameter.max_pe_distance_neigh is used to find all the neighbors in the first place. Therefore, QMParameter.max_pe_distance_neigh should be at least larger then QMParameter.max_pe_polarization_distance_neigh or QMParameter.max_qm_box_distance_neigh. If you want all the neighbors to be described with polarizabilities until a distance D,  set QMParameter.max_pe_distance_neigh to D and MParameter.max_pe_polarization_distance_neigh to something larger then D.  </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        If QMParameter.pe_level is larger then the MD box, FROG uses the PBC condition defines in GP.env_authorised_pbc_condition to extend the accessible neighborhood by copying the QM box. </span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_pe_distance_neigh</span><span class="p">)</span>
    
    <span class="nd">@max_pe_distance_neigh</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">max_pe_distance_neigh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.max_pe_distance_neigh cannot be negatif!&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.max_pe_distance_neigh can only be float.&#39;</span><span class="p">)</span>
        
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.max_pe_distance_neigh  name to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_pe_distance_neigh</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">max_pe_polarization_distance_neigh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [float]  </span>
<span class="sd">        </span>
<span class="sd">        Parameter meaningfull only for QMParameter.calculation_style = &#39;PE&#39; or &#39;PE + QM&#39;.</span>
<span class="sd">        </span>
<span class="sd">        If QMParameter.pe_level = 1, set the maximal distance to add an electrostatic neighborgs which can be polarizable. The neigbors which will be described using polarizabilities should be closer then QMParameter.max_pe_polarization_distance_neigh. If neighbors are closer then QMParameter.max_pe_distance_neigh but futher away then QMParameter.max_pe_polarization_distance_neigh, they are described with no polarizabilities. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        If you want to describe all the neighbors using polarizabilities, set QMParameter.max_pe_polarization_distance_neigh &gt;  QMParameter.max_pe_distance_neigh.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_pe_polarization_distance_neigh</span><span class="p">)</span>
    
    <span class="nd">@max_pe_polarization_distance_neigh</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">max_pe_polarization_distance_neigh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.max_pe_polarization_distance_neigh cannot be negatif!&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.max_pe_polarization_distance_neigh can only be float.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.max_pe_polarization_distance_neigh  name to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_pe_polarization_distance_neigh</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">max_qm_box_distance_neigh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [float]  </span>
<span class="sd">        </span>
<span class="sd">        Parameter meaningfull only for QMParameter.calculation_style = &#39;PE + QM&#39;.</span>
<span class="sd">        </span>
<span class="sd">        If the distance between a neighbors and the target molecule is less then QMParameter.max_qm_box_distance_neigh, the neighbors is added to the QM box. Therefore, this neighbors is no longer in the &#39;&#39;electrostatic environment&#39;&#39;. It is the best way to add the effect of a neighbors to a target molecule because it will contain all the electrostatic and quatum effect. </span>
<span class="sd">        </span>
<span class="sd">        However, it may be more difficult to understand the optical result obtained because they are no longer from a &#39;&#39;single molecule&#39;&#39; but a graps of molecule. </span>
<span class="sd">        </span>
<span class="sd">        Be aware that setting a large QMParameter.max_qm_box_distance_neigh will increase a lot the number of electron in the QM box, and therefore increase the QM calculation time. </span>
<span class="sd">        </span>
<span class="sd">        In the more complexe environment case: QMParameter.calculation_style = &#39;PE + QM&#39; and QMParameter.pe_level = 1. A molecule is added to the QM box if its distance from the target molecule is less then QMParameter.max_qm_box_distance_neigh. If it is not the case, it is added to the electrostatic environment using polarizability description if its distance is less then QMParameter.max_pe_polarization_distance_neigh. If it is not the case, it is added to the electrostatic environement without polarizability if its distance is less then QMParameter.max_pe_distance_neigh. If the neighbors is futher away, it does not affect the QM calculation. </span>
<span class="sd">        </span>
<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        The functionality has not been widely tested. Please take some time to check the dalton input created before running tons of calculation -- especially if you have very long molecule!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_qm_box_distance_neigh</span><span class="p">)</span>
    
    <span class="nd">@max_qm_box_distance_neigh</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">max_qm_box_distance_neigh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.max_qm_box_distance_neigh cannot be negatif!&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.max_qm_box_distance_neigh can only be float.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.max_qm_box_distance_neigh  name to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_qm_box_distance_neigh</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">long_range_switch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [Bool]  </span>
<span class="sd">        </span>
<span class="sd">        Parameter meaningfull only for QMParameter.calculation_style = &#39;PE&#39;.</span>
<span class="sd">        </span>
<span class="sd">        Intern variable set by Frog. If set to True, some neighbors can be part of the &#39;long range&#39; environment. If False, such case cannot happened.</span>
<span class="sd">        This variable is usefull for code lisibility/efficiency</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_long_range_switch</span><span class="p">)</span>
    
    <span class="nd">@long_range_switch</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">long_range_switch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.long_range_switch can only be bool or str.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.long_range_switch to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_long_range_switch</span> <span class="o">=</span> <span class="n">value</span> 
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">long_range_distance_switch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [float or str]  </span>
<span class="sd">        </span>
<span class="sd">        Parameter meaningfull only for QMParameter.calculation_style = &#39;PE&#39;.</span>
<span class="sd">        </span>
<span class="sd">        Defined a distance after which the neighbors are not included explicitly in the PE environement. </span>
<span class="sd">        After this distance, the neighbors electrostatic field is computed at the target molecule &#39;mean position&#39; in the laboratory frame. </span>
<span class="sd">        This contribution is added to all the other neighborgs after this distance, and closer than max_pe_distance_neigh. </span>
<span class="sd">        The total electrostatic field is added to the QM box as if it was an spatially homogenous field. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        If long_range_distance_switch &gt; max_pe_distance_neigh nothing for the environment description. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        You can also defined an extra electrostatic field using static_electric_field and static_electric_field_direction. This field would be added to the one created by the long-range environment. </span>
<span class="sd">        </span>
<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        Today this scheme works only for PE level=0 and for point charge for the electrostatic description. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_long_range_distance_switch</span><span class="p">)</span>
    
    <span class="nd">@long_range_distance_switch</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">long_range_distance_switch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.long_range_distance_switch cannot be negatif!&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.long_range_distance_switch can only be float.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.long_range_distance_switch to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_long_range_distance_switch</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rcut_PE_direct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [float]  </span>
<span class="sd">        </span>
<span class="sd">        Parameter meaningfull only for QMParameter.calculation_style = &#39;PE long&#39;. For &#39;PE&#39;  or &#39;PE + QM&#39; use QMParameter.max_pe_distance_neigh instead. </span>
<span class="sd">        </span>
<span class="sd">        Set the maximal distance to add an electrostatic neighborgs directly. The neighbors is add without polarizabilities.</span>
<span class="sd">        </span>
<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        The QMParameter.rcut_PE_direct should be smaller then the MD box size at any time! The QMParameter.calculation_style = &#39;PE long&#39; was especially designed to avoid building large direct electrostatic environement!!! If you are uncertain about the radius to use, try out some value! You can also see the electrostatic field derivative generated by the long-range part to better understand the direct radius to use. See the electrostatic_field diagram.  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rcut_PE_direct</span><span class="p">)</span>
    
    <span class="nd">@rcut_PE_direct</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">rcut_PE_direct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.rcut_PE_direct cannot be negatif!&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.rcut_PE_direct can only be float.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.rcut_PE_direct  name to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_rcut_PE_direct</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rcut_PE_smoth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [float]  </span>
<span class="sd">        </span>
<span class="sd">        Parameter meaningfull only for QMParameter.calculation_style = &#39;PE long&#39;.</span>
<span class="sd">        </span>
<span class="sd">        Used to defined a smothing radius thoughout which the neighborgs are added both in the direct and long-range part. If a nieghbors is within QMParameter.rcut_PE_direct from the target molecule, it is added directly in the Dalton potential file using the charge, dipole and quadrupole moment defined in its molecular library module. If a neighbors distance from the target molecule is between QMParameter.rcut_PE_direct and QMParameter.rcut_PE_smoth, it is added to the potential file but with a smaller charge, dipole and quadrupole moment. The rescaling factor used is given by the QMParameter.ewald_factor parameter:</span>
<span class="sd">        </span>
<span class="sd">        rescaling_factor = np.exp(-(distance_from_target/qmparameter.ewald_factor)**2)</span>
<span class="sd">        </span>
<span class="sd">        The direct part is rescaled using the rescaling_factor, the long range part using (1-rescaling_factor)</span>
<span class="sd">        </span>
<span class="sd">        If a neighbors is futher away then QMParameter.rcut_PE_direct and QMParameter.rcut_PE_smoth, its contributes to the electrostatic environement by an homogenous electrostatic field - with its full charge, dipole and/or quadrupole moment. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        If you do not want to use this feature, set QMParameter.rcut_PE_smoth &lt; QMParameter.rcut_PE_direct</span>
<span class="sd">        </span>
<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        This functionality has not been widely used. It may be usefull if you have ionic molecule where the electrostatic field generated is very strong. Or you can use a larger QMParameter.rcut_PE_smoth.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rcut_PE_smoth</span><span class="p">)</span>
    
    <span class="nd">@rcut_PE_smoth</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">rcut_PE_smoth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.rcut_PE_smoth cannot be negatif!&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.rcut_PE_smoth can only be float.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.rcut_PE_smoth  name to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_rcut_PE_smoth</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ewald_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [float]  </span>
<span class="sd">        </span>
<span class="sd">        Parameter meaningfull only for QMParameter.calculation_style = &#39;PE long&#39;.</span>
<span class="sd">        </span>
<span class="sd">        Set the rescaling paramter used for the molecule within 0 &lt; QMParameter.rcut_PE_direct &lt; QMParameter.rcut_PE_smoth from the target molecule </span>
<span class="sd">        </span>
<span class="sd">        The rescaling parameter is given by:</span>
<span class="sd">        </span>
<span class="sd">        rescaling_factor = np.exp(-(distance_from_target/qmparameter.ewald_factor)**2)</span>
<span class="sd">        </span>
<span class="sd">        The direct part is rescaled using the rescaling_factor, the long range part using (1-rescaling_factor)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ewald_factor</span><span class="p">)</span>
    
    <span class="nd">@ewald_factor</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">ewald_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.ewald_factor can only be float.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.ewald_factor  name to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_ewald_factor</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">PE_k_vector_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [list of int]  </span>
<span class="sd">        </span>
<span class="sd">        Parameter meaningfull only for QMParameter.calculation_style = &#39;PE long&#39;.</span>
<span class="sd">        </span>
<span class="sd">        Set the number of QM box to repeat in the given direction to add to the target molecule long-range electrostatic field. For each repated box, all the molecule contributes to the long range electorstatic field.</span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        QMParameter.PE_k_vector_range = [2, 2, 2]</span>
<span class="sd">        </span>
<span class="sd">        This case representa a 3D PBC. Lets say the initial box is a 2x2x2nm box and that QMParameter.rcut_PE_direct = 10 Angstrom. One target molecule neighborhood is built up to 10 Angstrom. The found neighborgs contribute directly to the electrostatic environement with the dalton potential file. The rest of the molecule in the box contribute to the QM calculation by adding a homogenous electrostatic field. </span>
<span class="sd">        </span>
<span class="sd">        Then, the box is reapeated 2 times in every direction, creating a 10x10x10nm box. Every molecule in this extended box contributes to the long-range part except the one that are within a radius of 1 nm. This include the periodic copy of the target molecule itself. </span>
<span class="sd">        </span>
<span class="sd">        QMParameter.PE_k_vector_range = [3, 3, 0]</span>
<span class="sd">        </span>
<span class="sd">        This case represents a 2D PBC. If the initial box is a 2x2x10m, the repeated one will be 14x14x10 nm. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        The obtained &#39;&#39;repeated box&#39;&#39; is centered around the target molecule.</span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        This parameter can be completly different from the GP.env_authorised_pbc_condition. However, they represent more or less the same thing: what is the symetry of the system (bulk, plane ect...). </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        Using many repetition can lead to a very high numerical cost. Try out small one and the obtained result before asking for large QMParameter.PE_k_vector_range value!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_PE_k_vector_range</span><span class="p">)</span>
    
    <span class="nd">@PE_k_vector_range</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">PE_k_vector_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.PE_k_vector_range can only be a list.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.PE_k_vector_range  name to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_PE_k_vector_range</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">static_electric_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [str]  </span>
<span class="sd">        </span>
<span class="sd">        Add an **homogenous** electric field for every molecule of this MT during the QM calculation. The value is given in atomic unit. You can add an electric field in any direction in the laboratory or in the molecular frame. To select the frame, use the attribute QMParameter.static_electric_field_direction. </span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        QMParameter.static_electric_field_direction = &#39;Laboratory&#39;</span>
<span class="sd">        QMParameter.static_electric_field = [0.003, 0.0001, 0]</span>
<span class="sd">        </span>
<span class="sd">        An extra electric field is added along the direction X with amplitude 0.003 a.u., another in the Y direction with amplitude 0.0001 a.u. This electric field will be the same for all the molecule of this MT.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        QMParameter.static_electric_field_direction = &#39;Molecular&#39;</span>
<span class="sd">        QMParameter.static_electric_field = [0.0, 0.0, 0.0005]</span>
<span class="sd">        </span>
<span class="sd">        An extra electric field is added along the molecular direction z with amplitude 0.0005 a.u. This electric field will be diferent for every molecule because it will depend on the molecular orientation. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        If you are using the QMParameter.calculation_style = &#39;PE long&#39;, for every molecule the long-range part is added by a very similar processus. You can use both QMParameter.calculation_style = &#39;PE long&#39; and QMParameter.static_electric_field: each molecule will have an extra homogenous electric field which will be the sum of the one produced by the long-range environment, and one given for every molecule by QMParameter.static_electric_field.</span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        If you do not want to add an electrostatic electric field, do not initialize QMParameter.static_electric_field nor  QMParameter.static_electric_field_direction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_static_electric_field</span><span class="p">)</span>
    
    <span class="nd">@static_electric_field</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">static_electric_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.static_electric_field can only be a list or str.&#39;</span><span class="p">)</span>
        <span class="c1"># logging.info(&#39;Setting the QMParameter.static_electric_field to %s&#39;, value) # to much print in the case of the &#39;Molecular&#39; frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_static_electric_field</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">static_electric_field_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [str]  </span>
<span class="sd">        </span>
<span class="sd">        Parameter meaningfull only if a QMParameter.static_electric_field has been set.</span>
<span class="sd">        </span>
<span class="sd">        Provide in which frame the electrostatic field given in QMParameter.static_electric_field is expressed. It can be either in the &#39;Molecular&#39; frame, or the &#39;Laboratory&#39; one. </span>
<span class="sd">        </span>
<span class="sd">        The laboratory frame is quite straightforeward to understand: it represents an extra electric field which impact all the MD box.</span>
<span class="sd">        </span>
<span class="sd">        The molecular frame may not reproduce any physical situtation. However, it is very handy to compute optical property using the Finite Field formalism. </span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        See the QMParameter.static_electric_field attribute</span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        To get the molecular electric field if QMParameter.static_electric_field_direction = &#39;Molecular&#39;:</span>
<span class="sd">        </span>
<span class="sd">        static_electric_field_mol = toolbox.rotate_1st_order_tensor(rot_mat.T, QMParameter.static_electric_field)</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_static_electric_field_direction</span><span class="p">)</span>
    
    <span class="nd">@static_electric_field_direction</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">static_electric_field_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.static_electric_field_direction can only be string.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.static_electric_field_direction to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_static_electric_field_direction</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">theory_lv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [str]  </span>
<span class="sd">        </span>
<span class="sd">        Set the &#39;theory level&#39; used for solving the electronic quantum problem. </span>
<span class="sd">        </span>
<span class="sd">        Today, only the DFT framework is available in Frog. Not because the rest would arise important problem, Dalton is very powerfull and provide optical reponse for many framework, but because the Frog users do not need more at until today. Therefore, if you need to use other framework, please contact us -- or code it directly in Frog: it will not be complicate!</span>
<span class="sd">        </span>
<span class="sd">            + DFT:</span>
<span class="sd">        </span>
<span class="sd">        For DFT calculation, you need to provide to Frog the functionla you want to use, using the QMParameter.functional.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        For DFT:</span>
<span class="sd">        </span>
<span class="sd">        QMParameter.theory_lv = &#39;DFT&#39;</span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        Please note that some theory level/functional cannot be used to compute optical properties in Dalton. Therefore, we strongly recommand to test new framework on very few molecule to make sure the QM calculation works. </span>
<span class="sd">        </span>
<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        If you are using the QMParameter.calculation_style = &#39;PE + QM&#39;, it would be easier to use the same framework for every MT.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_theory_lv</span><span class="p">)</span>
    
    <span class="nd">@theory_lv</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">theory_lv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.theory_lv can only be str.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.theory_lv to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_theory_lv</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">functional</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [str]  </span>
<span class="sd">        </span>
<span class="sd">        Parameter meaningfull only if QMParameter.theory_lv = &#39;DFT&#39;.</span>
<span class="sd">        </span>
<span class="sd">        Set the functional to use for this MT. The name you give to this attribute will be directly written in the dalotn.dal Dalton file without more checking: it is up to you to use a valid Dalton functional name.</span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        QMParameter.functional = &#39;Camb3lyp&#39;</span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        Sadly, for some functional, Dalton may not be able to compute optical properties.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_functional</span><span class="p">)</span>
    
    <span class="nd">@functional</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">functional</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.functional can only be string.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.functional to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_functional</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">type_basis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [str]  </span>
<span class="sd">        </span>
<span class="sd">        Define the type of basis to use. This parameter was written originaly because you may want to chose a basis set for all the molecule, or for each atom.</span>
<span class="sd">        </span>
<span class="sd">        Today, only &#39;Global basis&#39; are implemented in Frog -- every atomic orbital are described using the same general basis set. If needed, it would not be difficult to define basis set for every atom. </span>
<span class="sd">        </span>
<span class="sd">            + &#39;Global basis&#39;</span>
<span class="sd">        </span>
<span class="sd">        Every atomic orbital are described using the same basis set. To provide the basis set, use QMParameter.global_basis_value .</span>
<span class="sd">       </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        QMParameter.type_basis = &#39;Global basis&#39;</span>
<span class="sd">        QMParameter.global_basis_value = &#39;d-aug-cc-pVTZ&#39;</span>
<span class="sd">        </span>
<span class="sd">        The basis &#39;d-aug-cc-pVTZ&#39; (very large, indended for hyperpolarizability calculation) is used for all the atom of this MT. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_type_basis</span><span class="p">)</span>
    
    <span class="nd">@type_basis</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">type_basis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.type_basis can only be string.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.type_basis to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_type_basis</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">global_basis_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [str]  </span>
<span class="sd">        </span>
<span class="sd">        Parameter meaningfull only if QMParameter.type_basis = &#39;Global basis&#39;.</span>
<span class="sd">        </span>
<span class="sd">        Defines the basis set to use for every atomic orbital. </span>
<span class="sd">        </span>
<span class="sd">        The basis set is written written in the molecule.mol Dalton file without more checking: it is up to you to use a valid Dalton basis name.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_global_basis_value</span><span class="p">)</span>
    
    <span class="nd">@global_basis_value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">global_basis_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.global_basis_value can only be string.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.global_basis_value to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_global_basis_value</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">total_charge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [int]  </span>
<span class="sd">        </span>
<span class="sd">        Add an extra charge to the molecule of this MT. By default, no charge is defined. </span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        QMParameter.total_charge = int(-1)</span>
<span class="sd">        </span>
<span class="sd">        Defines an anionic molecule. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        If ionic molecular are defined in the molecular library file, it would be very likely that this property is already defined there. So check the qm_target_description function of the MT if a charge is already defined. The charge defined in the qm_target_description will overwrite the one defined in the parameter file if any. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_total_charge</span><span class="p">)</span>
    
    <span class="nd">@total_charge</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">total_charge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.total_charge can only be int.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.total_charge to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_total_charge</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">polarizability_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [list or bool]  </span>
<span class="sd">        </span>
<span class="sd">        Defines the frequency at which the polarizability of this MT should be recorded. The frequency are given in atomic unit. </span>
<span class="sd">        For every frequency required, a diagram is created where its last part of the name is the frequency. Moreover, a SingleMolecule attribute is also created for each frequency. </span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        QMParameter.polarizability_response = [0.0, 0.05686, 0.11372] </span>
<span class="sd">        </span>
<span class="sd">        3 frequency are required: infinite wave-length (0 atomic unit), 800 nm (0.05686) and 400 nm (0.11372). </span>
<span class="sd">        </span>
<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        Today, the polarizability calculation can only be perform if hyperpolrizability calculation are required. The frequency available in the polrizability are limited by the one required in the hyperpolarizability calculation. Until now, Frog has been many used for hyperpolarizability calculation. Please contact us if you want to use only polarizability calculation.</span>
<span class="sd">        </span>
<span class="sd">        Therefore, if you want to have these frequency for the polarizability, you have to set at least these one for the hyperpolarizability:</span>
<span class="sd">        </span>
<span class="sd">        QMParameter.shg_response = [0.0, 0.05686]</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_polarizability_response</span><span class="p">)</span>
    
    <span class="nd">@polarizability_response</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">polarizability_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.polarizability_response can only be bool or list.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.polarizability_response  to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_polarizability_response</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shg_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [list or bool]  </span>
<span class="sd">        </span>
<span class="sd">        Defines the frequency at which the first hyperpolarizability of this MT should be recorded. The frequency are given in atomic unit. The frequency are for the excitation wave-length: the created dipole oscilates at twice the frequency. </span>
<span class="sd">        </span>
<span class="sd">        For every frequency required, a diagram is created where its last part of the name is the frequency. Moreover, a SingleMolecule attribute is also created for each frequency. </span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        QMParameter.shg_response = [0.0, 0.05686]</span>
<span class="sd">        </span>
<span class="sd">        2 frequency are required: infinite wave-length (0 atomic unit) and 800 nm (0.05686).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shg_response</span><span class="p">)</span>
    
    <span class="nd">@shg_response</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">shg_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.shg_response can only be bool or list.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.shg_response to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_shg_response</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">max_iter_scf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [int]  </span>
<span class="sd">        </span>
<span class="sd">        Set the maximal SCF iteration for the electronic degree of freedom solving procedure. </span>
<span class="sd">        </span>
<span class="sd">        By default set to 500</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_iter_scf</span><span class="p">)</span>
    
    <span class="nd">@max_iter_scf</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">max_iter_scf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.max_iter_scf can only be int.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.max_iter_scf  to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_iter_scf</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">restart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [bool]  </span>
<span class="sd">        </span>
<span class="sd">        Originaly created to perform a restart calculation from a template electronic problem to reduce the QM cost. </span>
<span class="sd">        </span>
<span class="sd">        Until today, this feature has not been used. Mainly because only small molecule have been used, and because the reponse part is more CPU-demanding then the electronic energy problem. </span>
<span class="sd">        </span>
<span class="sd">        If you want to use this feature, please contact us. But keep in mind that in any case the response part will have to be compute for every molecule! </span>
<span class="sd">        </span>
<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        QMParameter.restart shall be False</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_restart</span><span class="p">)</span>
    
    <span class="nd">@restart</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">restart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.restart can only be bool.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.restart to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_restart</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">write_xyz_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [bool]  </span>
<span class="sd">        </span>
<span class="sd">        Set if the electrostatic environment should be written in an .xyz file or not. By default set to False. </span>
<span class="sd">        </span>
<span class="sd">        If set to True, a .xyz file is written at the location where the Dalton input and output are. It represent the *direct* electrostatic environement. You can open this file using VMD for instance. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        The default value is False to reduce the disk-space occupency. However, we warmly recommand to use this option at least at the beginingto check how the electrostatic emmebedding is performed</span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        If the option QMParameter.calculation_style = &#39;PE + QM&#39; is used, you can have also access to the molecule that are no longer in the electrostatic environement, but in the QM box. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_xyz_environment</span><span class="p">)</span>
    
    <span class="nd">@write_xyz_environment</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">write_xyz_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.write_xyz_environment can only be bool.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.write_xyz_environment to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_xyz_environment</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">RUN_pe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [bool]  </span>
<span class="sd">        </span>
<span class="sd">        Not user defined</span>
<span class="sd">        </span>
<span class="sd">        Attribute used to make the Frog excetution easier. Set to True if electrostatic envrionement are used.  Related to the dalton.dal file, see dalton_manager_module.generate_inp_dal .</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_RUN_pe</span><span class="p">)</span>
    
    <span class="nd">@RUN_pe</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">RUN_pe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.RUN_pe can only be bool.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.RUN_pe  name to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_RUN_pe</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">RUN_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [bool]  </span>
<span class="sd">        </span>
<span class="sd">        Not user defined</span>
<span class="sd">        </span>
<span class="sd">        Attribute used to make the Frog execution easier. Set to True by default. Related to the dalton.dal file, see dalton_manager_module.generate_inp_dal .</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_RUN_properties</span><span class="p">)</span>
    
    <span class="nd">@RUN_properties</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">RUN_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.RUN_properties can only be bool.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.RUN_properties to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_RUN_properties</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">#################################################################################################################################     </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">RUN_integral</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [bool]  </span>
<span class="sd">        </span>
<span class="sd">        Not user defined</span>
<span class="sd">        </span>
<span class="sd">        Attribute used to make the Frog execution easier. Set to False by default. Related to the dalton.dal file, see dalton_manager_module.generate_inp_dal .</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_RUN_integral</span><span class="p">)</span>
    
    <span class="nd">@RUN_integral</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">RUN_integral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.RUN_integral can only be bool.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.RUN_integral to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_RUN_integral</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">#################################################################################################################################     </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">RUN_electric_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [bool]  </span>
<span class="sd">        </span>
<span class="sd">        Not user defined</span>
<span class="sd">        </span>
<span class="sd">        Attribute used to make the Frog execution easier. Set to False by default. Related to the dalton.dal file, see dalton_manager_module.generate_inp_dal .</span>
<span class="sd">        </span>
<span class="sd">        Set to True if any homogenous electrostatic field has to be added to the QM box. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_RUN_electric_field</span><span class="p">)</span>
    
    <span class="nd">@RUN_electric_field</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">RUN_electric_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.RUN_electric_field can only be bool.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.RUN_electric_field  name to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_RUN_electric_field</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">#################################################################################################################################     </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">RUN_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [bool]  </span>
<span class="sd">        </span>
<span class="sd">        Not user defined</span>
<span class="sd">        </span>
<span class="sd">        Attribute used to make the Frog execution easier. Set to False by default. Related to the dalton.dal file, see dalton_manager_module.generate_inp_dal .</span>
<span class="sd">        </span>
<span class="sd">        Set to True if any optical property has to be computed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_RUN_response</span><span class="p">)</span>
    
    <span class="nd">@RUN_response</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">RUN_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.RUN_response can only be bool.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.RUN_response  name to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_RUN_response</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">#################################################################################################################################     </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">RUN_polarization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [bool]  </span>
<span class="sd">        </span>
<span class="sd">        Not user defined</span>
<span class="sd">        </span>
<span class="sd">        Attribute used to make the Frog execution easier. Set to False by default. Related to the dalton.dal file, see dalton_manager_module.generate_inp_dal .</span>
<span class="sd">        </span>
<span class="sd">        Set to True if the polarizability has to be computed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_RUN_polarization</span><span class="p">)</span>
    
    <span class="nd">@RUN_polarization</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">RUN_polarization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.RUN_polarization can only be bool.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.RUN_polarization to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_RUN_polarization</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">RUN_shg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [bool]  </span>
<span class="sd">        </span>
<span class="sd">        Not user defined</span>
<span class="sd">        </span>
<span class="sd">        Attribute used to make the Frog execution easier. Set to False by default. Related to the dalton.dal file, see dalton_manager_module.generate_inp_dal .</span>
<span class="sd">        </span>
<span class="sd">        Set to True if the hyperpolarizability has to be computed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_RUN_shg</span><span class="p">)</span>
    
    <span class="nd">@RUN_shg</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">RUN_shg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.RUN_shg can only be bool.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.RUN_shg to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_RUN_shg</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">effective_field_polarization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [bool]</span>
<span class="sd">        </span>
<span class="sd">        Not user defined</span>
<span class="sd">        </span>
<span class="sd">        Originaly designed for effective field (cavity field) calculation. Today not implemented. Shall remain False. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_effective_field_polarization</span><span class="p">)</span>
    
    <span class="nd">@effective_field_polarization</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">effective_field_polarization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMParameter.effective_field_polarization can only be bool.&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the QMParameter.effective_field_polarization to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_effective_field_polarization</span> <span class="o">=</span> <span class="n">value</span>           
<span class="c1">################################################################################################################################# </span>
<span class="c1">#################################################################################################################################</span>

<div class="viewcode-block" id="QMParameter.check_input_qm">
<a class="viewcode-back" href="../../Frog.html#Frog.class_OpticalParameter.QMParameter.check_input_qm">[docs]</a>
    <span class="k">def</span> <span class="nf">check_input_qm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">optparameter</span><span class="p">,</span> <span class="n">GP</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check if the input are incoherent and print messages to show what the software have understood. Initialized some internal variables used later on when writting the Dalton inputs for the conformations. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># What is the style of the QM calculation?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_style</span> <span class="o">==</span> <span class="s1">&#39;Vacuum&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculation_style</span> <span class="o">=</span> <span class="s1">&#39;PE&#39;</span> <span class="c1"># shortcut</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pe_level</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">IS_PE</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">IS_QMbox</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_xyz_environment</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_34_a</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_style</span> <span class="o">==</span> <span class="s1">&#39;PE&#39;</span><span class="p">:</span>
            <span class="n">IS_PE</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">IS_QMbox</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_34_b</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_style</span> <span class="o">==</span> <span class="s1">&#39;PE long&#39;</span><span class="p">:</span>
            <span class="n">IS_PE</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">IS_QMbox</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_34_c</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_style</span> <span class="o">==</span> <span class="s1">&#39;PE + QM box&#39;</span><span class="p">:</span>
            <span class="n">IS_PE</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">IS_QMbox</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_34_d</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="n">e_116</span><span class="p">())</span>
        
        <span class="c1"># Check PE parameters and update the maximal PE order for the whole run:</span>
        <span class="k">if</span> <span class="n">IS_PE</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_style</span> <span class="o">==</span> <span class="s1">&#39;PE&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_style</span> <span class="o">==</span> <span class="s1">&#39;PE + QM box&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">long_range_distance_switch</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">long_range_switch</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">long_range_switch</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">RUN_integral</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">RUN_electric_field</span> <span class="o">=</span> <span class="kc">True</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">effective_field_polarization</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: effective_field_polarization should be boolean only. Please correct this.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">effective_field_polarization</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pe_level</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: the effective_field_polarization should be used along with PE order of 1. Please set PE order to 1 or effective_field_polarization to False.&#39;</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_style</span> <span class="o">==</span> <span class="s1">&#39;PE&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_pe_distance_neigh</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pe_level</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="n">e_114</span><span class="p">())</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_35</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pe_level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_pe_polarization_distance_neigh</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Since PE order 1 is required, please initialize the distance &quot;max_pe_polarization_distance_neigh&quot;. The neighbors up to this distance will be described with their polarization, where neighbors futher away from the target molecule will be described without polarization -- for time-saving. If you want all the neighbors to be described using polarization, set max_pe_polarization_distance_neigh &gt; max_pe_distance_neigh.&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;PE order 1 is required. The neighbors up to &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_pe_polarization_distance_neigh</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Angstrom will be described with their polarization, where neighbors futher away from the target molecule will be described without polarization -- for time-saving. If you want all the neighbors to be described using polarization, set max_pe_polarization_distance_neigh &gt; max_pe_distance_neigh.&#39;</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">effective_field_polarization</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The effective field factor will be applied to compute the response values. This depends on the polarizable environment. To change it, set the variable effective_field_polarization .&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The effective field factor will not be applied to compute the response values -- default behavior. To change it, set the variable effective_field_polarization .&#39;</span><span class="p">)</span>
                
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_style</span> <span class="o">==</span> <span class="s1">&#39;PE long&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: currently the PE long approach is no longer available. We have worked on this idea and today use &quot;PE&quot; approach with the qmparameter.long_range_distance_switch attribute. Contact us if you want to use this method.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pe_level</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: the PE long scheme has been developed only for PE order = 0. Please use the &quot;PE&quot; scheme instead for order -1 or 1.&#39;</span><span class="p">)</span>
                    
                <span class="bp">self</span><span class="o">.</span><span class="n">RUN_integral</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RUN_electric_field</span> <span class="o">=</span> <span class="kc">True</span>
                
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rcut_PE_direct</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: Since the &quot;PE long&quot; envioronment scheme has been required, you have to initialize the maximal distance for the direct part using the attribute: qmparameter.rcut_PE_direct . It has to be a float.&#39;</span><span class="p">)</span> 
                <span class="k">for</span> <span class="n">box_size</span> <span class="ow">in</span> <span class="n">GP</span><span class="o">.</span><span class="n">box_size</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rcut_PE_direct</span> <span class="o">&gt;</span> <span class="n">box_size</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: your MD box size is smaller than the qmparameter.rcut_PE_direct attribute. This should not be the case. If you want to use direct inclusion larger than the box size use &quot;PE&quot; environement instead of &quot;PE long&quot;.&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The direct part of the PE environment will be considerated up to &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rcut_PE_direct</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; angstrom from the mean position of this MT.&#39;</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rcut_PE_smoth</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: Since the &quot;PE long&quot; envioronment scheme has been required, you have to initialize the maximal distance for the smothing part using the attribute: qmparameter.rcut_PE_smoth . It has to be a float. Note that if you do not want this functionality, set qmparameter.rcut_PE_smoth &lt; qmparameter.rcut_PE_direct.&#39;</span><span class="p">)</span> 
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The smothing part of the PE environment will be considerated up to &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rcut_PE_smoth</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; angstrom from the mean position of this MT.&#39;</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ewald_factor</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: Since the &quot;PE long&quot; envioronment scheme has been required, you have to initialize the screaning factor used for the smothing part using the attribute: qmparameter.ewald_factor .&#39;</span><span class="p">)</span> 
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The screaning factor for the smothing part of the PE environment is set to: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ewald_factor</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; angstrom. The screaning rescaling is computed using: np.exp(-(distance_from_target/qmparameter.ewald_factor)**2).&#39;</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PE_k_vector_range</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: Since the &quot;PE long&quot; envioronment scheme has been required, you have to initialize the number of box duplication along the PBC you want to perform using the attribute: qmparameter.PE_k_vector_range .&#39;</span><span class="p">)</span> 
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The number of box duplication along the x, y, z direction will be: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PE_k_vector_range</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;. Please note that it will be done in both the positive and negative direction.&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">L_k_vector</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">kx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">PE_k_vector_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">PE_k_vector_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">ky</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">PE_k_vector_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">PE_k_vector_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">kz</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">PE_k_vector_range</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">PE_k_vector_range</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">L_k_vector</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">kz</span><span class="p">])</span>
                <span class="c1"># avoid the (0, 0, 0) vector:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">L_k_vector</span><span class="o">.</span><span class="n">remove</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L_k_vector</span><span class="o">.</span><span class="n">remove</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">IS_QMbox</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_qm_box_distance_neigh</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="n">e_115</span><span class="p">())</span> 
            <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_38</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">GP</span><span class="o">.</span><span class="n">IS_QM_box</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">GP</span><span class="o">.</span><span class="n">preference_functional</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> <span class="c1"># GP.preference_functional not defined yet.</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preference_functional</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="n">e_117</span><span class="p">())</span> 
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">GP</span><span class="o">.</span><span class="n">preference_functional</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preference_functional</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_39</span><span class="p">(</span><span class="n">GP</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">IS_PE</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_qm_box_distance_neigh</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_pe_distance_neigh</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="n">e_118</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> 
            
        <span class="k">if</span> <span class="n">IS_QMbox</span> <span class="ow">or</span> <span class="n">IS_PE</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_xyz_environment</span><span class="p">:</span>
                 <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_36</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_37</span><span class="p">()</span>
            
            <span class="c1"># Check if they are more selection for the environment:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">more_select_environment</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">more_select_environment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Absolute position&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">more_select_environment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Relative position&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">more_select_environment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Absolute position&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">more_select_environment</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: the more_select_environment input is ill defined, please check the documentation!&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">more_select_environment</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: the more_select_environment input is ill defined, please check the documentation!&#39;</span><span class="p">)</span>
                    
                    
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">more_select_environment</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Plane_&#39;</span><span class="p">:</span>
                        <span class="n">axis_of_interest</span><span class="p">,</span> <span class="n">direction_toprint</span><span class="p">,</span> <span class="n">slice_size</span> <span class="o">=</span> <span class="n">geometry_manager</span><span class="o">.</span><span class="n">init_plane_axis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">more_select_environment</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">6</span><span class="p">:],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>  
                        <span class="bp">self</span><span class="o">.</span><span class="n">more_selection_axis_of_interest</span> <span class="o">=</span> <span class="n">axis_of_interest</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">more_selection_distance_max_authorized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">more_select_environment</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span> 
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: The possible value for the selection is with respect to the laboratory axis: either Plane_xy, Plane_xz or Plane_yz for the axis z, y and x respectively.&#39;</span><span class="p">)</span>
                        
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">more_select_environment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Absolute position&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">more_selection_up_or_down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">more_select_environment</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">more_selection_up_or_down</span> <span class="o">!=</span> <span class="s1">&#39;larger&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">more_selection_up_or_down</span> <span class="o">!=</span> <span class="s1">&#39;smaller&#39;</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: The last aregument of more_select_environment should be &quot;larger&quot; or &quot;smaller&quot;&#39;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;In top of the radius used to defined the environment of this molecule type, a neighbourg will be considered only if its position in the &#39;</span> <span class="o">+</span> <span class="n">direction_toprint</span>  <span class="o">+</span> <span class="s1">&#39;-axis is &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">more_selection_up_or_down</span> <span class="o">+</span> <span class="s1">&#39; then &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">more_selection_distance_max_authorized</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;In top of the radius used to defined the environment of this molecule type, a neighbourg will be considered only if its positions from the target molecule in the &#39;</span> <span class="o">+</span> <span class="n">direction_toprint</span>  <span class="o">+</span> <span class="s1">&#39;-axis is smaller then &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">more_selection_distance_max_authorized</span><span class="p">))</span>  
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: The more_select_environment possible type are: &lt;Absolute position&gt; or &lt;Relative position&gt;.&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">more_select_environment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">more_select_environment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No special selection will be added to construct the environement.&#39;</span><span class="p">)</span>
        
        <span class="c1">#check the QM input</span>
        <span class="k">if</span> <span class="n">optparameter</span><span class="o">.</span><span class="n">alpha_calculation_style</span> <span class="o">==</span> <span class="s1">&#39;QM&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">optparameter</span><span class="o">.</span><span class="n">beta_calculation_style</span> <span class="o">==</span> <span class="s1">&#39;QM&#39;</span><span class="p">:</span>
                <span class="n">polarizability</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">shg</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">polarizability</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">shg</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">optparameter</span><span class="o">.</span><span class="n">beta_calculation_style</span> <span class="o">==</span> <span class="s1">&#39;QM&#39;</span><span class="p">:</span>
                <span class="n">polarizability</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">shg</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="n">e_119</span><span class="p">())</span>  

        <span class="c1"># theory level:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">theory_lv</span> <span class="o">==</span> <span class="s1">&#39;DFT&#39;</span><span class="p">:</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_40</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="n">e_120</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> 
            
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">static_electric_field</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_41</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_electric_field_direction</span> <span class="o">==</span> <span class="s1">&#39;Laboratory&#39;</span><span class="p">:</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_42_a</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_electric_field_direction</span> <span class="o">==</span> <span class="s1">&#39;Molecular&#39;</span><span class="p">:</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_42_b</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NotAnOptionError</span><span class="p">(</span><span class="s1">&#39;WARNING: since a QMParameter.static_electric_field has been set you shall define the frame in which this field is expressed. Used either &quot;Laboratory&quot; or &quot;Molecular&quot;.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RUN_integral</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RUN_electric_field</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pe_level</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> 
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pe_level</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RUN_pe</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="c1"># molecular part:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_basis</span> <span class="o">==</span> <span class="s1">&#39;Global basis&#39;</span><span class="p">:</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_43</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="n">e_121</span><span class="p">())</span>  
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_charge</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_44</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    
        <span class="c1"># Response:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polarizability_response</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RUN_response</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RUN_polarization</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_45</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">polarizability</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="n">e_122</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_46</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">polarizability</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="n">e_123</span><span class="p">())</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shg_response</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RUN_response</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RUN_shg</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_47</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">shg</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="n">e_124</span><span class="p">())</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_48</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">()</span>    
            <span class="k">if</span> <span class="n">shg</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="n">e_125</span><span class="p">())</span> 
            
        <span class="c1"># Intern variables: (depend on what have been set above)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="n">e_126</span><span class="p">())</span> 
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">RUN_response</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">RUN_shg</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_order</span> <span class="o">==</span> <span class="s1">&#39;quadrupole&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">RUN_integral</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">RUN_int_dipole</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">RUN_int_quadrupole</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">RUN_electric_field</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RUN_integral</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RUN_int_dipole</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="n">messages</span><span class="o">.</span><span class="n">user_frendly_49</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

        
<span class="c1">#################################################################################################################################</span>
        
<div class="viewcode-block" id="QMParameter.merge_qmparameter">
<a class="viewcode-back" href="../../Frog.html#Frog.class_OpticalParameter.QMParameter.merge_qmparameter">[docs]</a>
    <span class="k">def</span> <span class="nf">merge_qmparameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">otherself</span><span class="p">,</span> <span class="n">GP</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Merge the theory description in the case of PE + QM box type of calculation: several molecule in the QM box. This is done so that only one type of theory description is used for both molecules.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">theory_lv</span> <span class="o">==</span> <span class="s1">&#39;DFT&#39;</span> <span class="ow">and</span> <span class="n">otherself</span><span class="o">.</span><span class="n">theory_lv</span> <span class="o">==</span> <span class="s1">&#39;DFT&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">functional</span> <span class="o">!=</span> <span class="n">otherself</span><span class="o">.</span><span class="n">functional</span><span class="p">:</span>
                <span class="n">index_list_self</span> <span class="o">=</span> <span class="n">GP</span><span class="o">.</span><span class="n">preference_functional</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">functional</span><span class="p">)</span>
                <span class="n">index_list_otherself</span> <span class="o">=</span> <span class="n">GP</span><span class="o">.</span><span class="n">preference_functional</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">otherself</span><span class="o">.</span><span class="n">functional</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">index_list_self</span> <span class="o">&lt;</span> <span class="n">index_list_otherself</span><span class="p">:</span> 
                    <span class="k">pass</span> 
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">functional</span> <span class="o">=</span> <span class="n">otherself</span><span class="o">.</span><span class="n">functional</span>
                
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: theory_lv != DFT Not implemented yet!&#39;</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">total_charge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_charge</span> <span class="o">+</span> <span class="n">otherself</span><span class="o">.</span><span class="n">total_charge</span></div>
</div>

        
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>

<div class="viewcode-block" id="QMDescription">
<a class="viewcode-back" href="../../Frog.html#Frog.class_OpticalParameter.QMDescription">[docs]</a>
<span class="k">class</span> <span class="nc">QMDescription</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Variable defined by the molecular module: </span>
<span class="sd">    - L_coordinate: [list of 3D array] The position of the atom described in the L_atom_type. Note that L_coordinate can be similar to the position given by the MD (with respect for the order of the atom for instance), but may be not depending on the molecular module function electrostatic_description. </span>
<span class="sd">    - L_atom_type: [list] The list of the atom in the molecule which contains the charge, the name and the localization with respect to the L_coordinate nomenclature used. Example: If the L_coordinate provide for a water molecule the coordinate in the order: Oxygen, Hydrogen, Hydrogen; then: [[8, 1, [&#39;0&#39;, 0]], [1, 2, [&#39;H&#39;, 1], [&#39;H&#39;, 2]]]. [8, 1, [&#39;0&#39;, 0]] is for: [charge, occurence in the molecule,  [name of the atom, position in the coordiante provided by the L_coordinate]]. Please do not use fency name for the atom (like O_1, H_c2 ect...). Otherwise, it may lead to problem when using the calculation style &#39;PE + QM box&#39; if different molecule type have to be put in the same QM box.  </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L_atom_type&#39;</span><span class="p">,</span> <span class="s1">&#39;L_coordinate&#39;</span><span class="p">]</span> 
        <span class="c1"># global initialization:</span>
        <span class="k">for</span> <span class="n">nameattribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameattribute</span><span class="p">,</span> <span class="s1">&#39;NotProvided&#39;</span><span class="p">)</span>  
        
        
        <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Prevent the attribution of undefine object to the class. This help avoiding bad spelling mistakes.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">NotAnOptionError</span><span class="p">(</span><span class="s1">&#39;The name </span><span class="si">%r</span><span class="s1"> is not a valide attribute for the QMParameter object.&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">NotAnOptionError</span><span class="p">(</span><span class="s1">&#39;The name </span><span class="si">%r</span><span class="s1"> is not a valide attribute for the QMParameter object.&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>

            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        
<span class="c1">#################################################################################################################################         </span>
<span class="c1">#################################################################################################################################        </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">L_atom_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [list]</span>
<span class="sd">        </span>
<span class="sd">        Atribute defines in the qm_target_description molecular library function. </span>
<span class="sd">        </span>
<span class="sd">        QMDescription.L_atom_type contains the the atom type name and the number of electrons associated. </span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        For Water:</span>
<span class="sd">        QMDescription.L_atom_type = [[8, 1, [[&#39;O&#39;, 0]]], [1, 2, [[&#39;H&#39;, 1], [&#39;H&#39;, 2]]]]</span>
<span class="sd">        </span>
<span class="sd">        The QMDescription.L_atom_type is composed of list. Each sub-list described one type of atom. For instance, for Water there are 2 atom type: [8, 1, [[&#39;O&#39;, 0]]] and [1, 2, [[&#39;H&#39;, 1], [&#39;H&#39;, 2]]]. </span>
<span class="sd">        </span>
<span class="sd">        The format is: [Nbr electron, Nbr of this atom type, [[name for this atom, index in the coordinate], [name for this atom, index in the coordinate], ...]]]</span>
<span class="sd">        </span>
<span class="sd">        The first list described the Oxygen atom. There is 8 electrons per atom and 1 Oxygen in this molecule. The atom is named &#39;O&#39; in the molecule.mol file, and its coordinate is given by: QMDescription.L_coordinate[0]</span>
<span class="sd">        </span>
<span class="sd">        The second list described the Hydrogen atom. There is 1 electrons per atom and 2 Hydrogen in this molecule. The first atom is named &#39;H&#39; in the molecule.mol file, and its coordinate is given by: QMDescription.L_coordinate[1]. The second atom is also named &#39;H&#39; in the molecule.mol file, and its coordinate is given by: QMDescription.L_coordinate[2]</span>
<span class="sd">        </span>
<span class="sd">        Another example of a Methanol molecule:</span>
<span class="sd">        QMDescription.L_atom_type = [[8, 1, [[&#39;O&#39;, 0]]], [1, 4, [[&#39;H&#39;, 1], [&#39;H&#39;, 3], [&#39;H&#39;, 4], [&#39;H&#39;, 5]]], [6, 1, [[&#39;C&#39;, 2]]]]</span>
<span class="sd">        </span>
<span class="sd">        There are 3 type of atom: Oxygen, Hydrogen and Carbon. </span>
<span class="sd">        </span>
<span class="sd">        The first list described the Oxygen atom. There is 8 electrons per atom and 1 Oxygen in this molecule. The atom is named &#39;O&#39; in the molecule.mol file, and its coordinate is given by: QMDescription.L_coordinate[0].</span>
<span class="sd">        </span>
<span class="sd">        The second list described the Hydrogen atom. There is 1 electrons per atom and 4 Hydrogen in this molecule. The all the Hydrogen are named &#39;H&#39; in the molecule.mol file, and their coordinates are given by: QMDescription.L_coordinate[1], QMDescription.L_coordinate[3], QMDescription.L_coordinate[4], QMDescription.L_coordinate[5].</span>
<span class="sd">        </span>
<span class="sd">        The third list described the Carbon atom. There is 6 electrons per atom and 1 Carbon in this molecule. The atom is named &#39;C&#39; in the molecule.mol file, and its coordinate is given by: QMDescription.L_coordinate[2].</span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        If you are using QMParameter.calculation_style = &#39;PE + QM&#39;, try to use (or modify) the same atom name to make easier the creating of graps. For instance, defines all the Oxygen using &#39;O&#39;, all the Hydrogen using &#39;H&#39; ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_L_atom_type</span><span class="p">)</span>
    
    <span class="nd">@L_atom_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">L_atom_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMDescription.L_atom_type can only be list or str.&#39;</span><span class="p">)</span>
        <span class="c1"># logging.info(&#39;Setting the QMParameter.L_atom_type  name to %s&#39;, value) # to much print</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_L_atom_type</span> <span class="o">=</span> <span class="n">value</span>                   
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">L_coordinate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [list]  </span>
<span class="sd">        </span>
<span class="sd">        Atribute defines in the qm_target_description molecular library function. </span>
<span class="sd">        </span>
<span class="sd">        QMDescription.L_coordinate contains the the atom position in the laboratory frame. The position shall be expressed in Angstrom.  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_L_coordinate</span><span class="p">)</span>
    
    <span class="nd">@L_coordinate</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">L_coordinate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute QMDescription.L_coordinate can only be list or str.&#39;</span><span class="p">)</span>
        <span class="c1"># logging.info(&#39;Setting the QMParameter.L_coordinate  name to %s&#39;, value) # to much print</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_L_coordinate</span> <span class="o">=</span> <span class="n">value</span> 
<span class="c1">#################################################################################################################################         </span>
<span class="c1">#################################################################################################################################</span>

<div class="viewcode-block" id="QMDescription.merge_mol">
<a class="viewcode-back" href="../../Frog.html#Frog.class_OpticalParameter.QMDescription.merge_mol">[docs]</a>
    <span class="k">def</span> <span class="nf">merge_mol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">otherself</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        TODO</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#print(&#39;self&#39;, self.L_atom_type, self.L_coordinate)</span>
        <span class="c1">#print(&#39;otherself&#39;, otherself.L_atom_type, otherself.L_coordinate)</span>
        
        <span class="n">L_new_coordinate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L_coordinate</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">otherself</span><span class="o">.</span><span class="n">L_coordinate</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">L_new_atom_type</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">L_list_atom_type</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">trotter_total</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="n">L_not_merged_otherself</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">atom_type_trotter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbr_type_atom</span><span class="p">()):</span>
            <span class="n">atom_type_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1">#print(&#39;self, atom_type_name&#39;, atom_type_name)</span>
            <span class="n">L_list_atom_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom_type_name</span><span class="p">)</span>
            <span class="n">IS_same_atom_type_in_otherself</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">atom_type_trotter_otherself</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">otherself</span><span class="o">.</span><span class="n">nbr_type_atom</span><span class="p">()):</span>
                <span class="n">atom_type_name_otherself</span> <span class="o">=</span> <span class="n">otherself</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter_otherself</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">atom_type_name_otherself</span> <span class="o">==</span> <span class="n">atom_type_name</span><span class="p">:</span>
                    <span class="c1">#print(&#39;self and otherself match&#39;, atom_type_name)</span>
                    <span class="n">IS_same_atom_type_in_otherself</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">L_new_atom_type_temp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">otherself</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter_otherself</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
                    <span class="n">L_new_list_of_atom_type</span> <span class="o">=</span> <span class="p">[]</span> 
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">L_new_list_of_atom_type</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">trotter_total</span><span class="p">])</span>
                        <span class="n">L_new_coordinate</span><span class="p">[</span><span class="n">trotter_total</span><span class="p">][:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_coordinate</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]][:]</span>
                        <span class="n">trotter_total</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">otherself</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter_otherself</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">L_new_list_of_atom_type</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">otherself</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter_otherself</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">trotter_total</span><span class="p">])</span>
                        <span class="c1">#print(&#39;tick: &#39;, otherself.L_atom_type[atom_type_trotter_otherself][2][k][1])</span>
                        <span class="n">L_new_coordinate</span><span class="p">[</span><span class="n">trotter_total</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">otherself</span><span class="o">.</span><span class="n">L_coordinate</span><span class="p">[</span><span class="n">otherself</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter_otherself</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]][:]</span>
                        <span class="n">trotter_total</span> <span class="o">+=</span> <span class="mi">1</span>    
                    <span class="n">L_new_atom_type_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">L_new_list_of_atom_type</span><span class="p">)</span>
                    <span class="c1">#print(&#39;adding L_new_atom_type_temp:&#39;, L_new_atom_type_temp)</span>
                    <span class="n">L_new_atom_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">L_new_atom_type_temp</span><span class="p">)</span>  
                        
            <span class="k">if</span> <span class="ow">not</span> <span class="n">IS_same_atom_type_in_otherself</span><span class="p">:</span> <span class="c1"># if self is the only one containing this kind of atom, add it to the list </span>
                <span class="c1">#print(&#39;in self but not in otherself: &#39;, atom_type_name)</span>
                <span class="n">L_new_atom_type_temp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">L_new_list_of_atom_type</span> <span class="o">=</span> <span class="p">[]</span> 
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">L_new_list_of_atom_type</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">trotter_total</span><span class="p">])</span>
                    <span class="n">L_new_coordinate</span><span class="p">[</span><span class="n">trotter_total</span><span class="p">][:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_coordinate</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]][:]</span>
                    <span class="n">trotter_total</span> <span class="o">+=</span> <span class="mi">1</span>   
                <span class="n">L_new_atom_type_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">L_new_list_of_atom_type</span><span class="p">)</span>
                <span class="c1">#print(&#39;adding L_new_atom_type_temp:&#39;, L_new_atom_type_temp)</span>
                <span class="n">L_new_atom_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">L_new_atom_type_temp</span><span class="p">)</span>  
         
        <span class="k">for</span> <span class="n">atom_type_trotter_otherself</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">otherself</span><span class="o">.</span><span class="n">nbr_type_atom</span><span class="p">()):</span> <span class="c1"># add the atom of otherself not present in self</span>
            <span class="n">atom_type_name_otherself</span> <span class="o">=</span> <span class="n">otherself</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter_otherself</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>    
            <span class="k">if</span> <span class="ow">not</span> <span class="n">atom_type_name_otherself</span> <span class="ow">in</span> <span class="n">L_list_atom_type</span><span class="p">:</span>
                <span class="c1">#print(&#39;in otherself but not in self:&#39;, atom_type_name_otherself)</span>
                <span class="n">L_new_atom_type_temp</span> <span class="o">=</span> <span class="p">[</span><span class="n">otherself</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter_otherself</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">otherself</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter_otherself</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">L_new_list_of_atom_type</span> <span class="o">=</span> <span class="p">[]</span> 
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">otherself</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter_otherself</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">L_new_list_of_atom_type</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">otherself</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter_otherself</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">trotter_total</span><span class="p">])</span>
                    <span class="n">L_new_coordinate</span><span class="p">[</span><span class="n">trotter_total</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">otherself</span><span class="o">.</span><span class="n">L_coordinate</span><span class="p">[</span><span class="n">otherself</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">[</span><span class="n">atom_type_trotter_otherself</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]][:]</span>
                    <span class="n">trotter_total</span> <span class="o">+=</span> <span class="mi">1</span>  
                    
                <span class="n">L_new_atom_type_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">L_new_list_of_atom_type</span><span class="p">)</span>
                <span class="c1">#print(&#39;adding L_new_atom_type_temp:&#39;, L_new_atom_type_temp)</span>
                <span class="n">L_new_atom_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">L_new_atom_type_temp</span><span class="p">)</span>  
            
        <span class="bp">self</span><span class="o">.</span><span class="n">L_coordinate</span> <span class="o">=</span> <span class="n">L_new_coordinate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_atom_type</span> <span class="o">=</span> <span class="n">L_new_atom_type</span></div>

        
        <span class="c1">#print(&#39;final : &#39;, self.L_atom_type, self.L_coordinate)</span>
        
<span class="c1">#################################################################################################################################</span>

<div class="viewcode-block" id="QMDescription.nbr_type_atom">
<a class="viewcode-back" href="../../Frog.html#Frog.class_OpticalParameter.QMDescription.nbr_type_atom">[docs]</a>
    <span class="k">def</span> <span class="nf">nbr_type_atom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the number of different atom type. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L_atom_type</span><span class="p">))</span></div>
</div>

        
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>

<div class="viewcode-block" id="ElectrostaticDescription">
<a class="viewcode-back" href="../../Frog.html#Frog.class_OpticalParameter.ElectrostaticDescription">[docs]</a>
<span class="k">class</span> <span class="nc">ElectrostaticDescription</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Property define by reading the molecular type module of each MT. </span>
<span class="sd">    </span>
<span class="sd">    Each molecule is decomposed into elementary charge, dipole, qudrupole or site to be polarized. These sites are them sorted into several list contained in this object and built while constructing the neighborhood. Once all the neighbors found, these sites are saved into the .pot file in the Dalton-frendly format so that it can be used during the QM/MM calculation. </span>
<span class="sd">    </span>
<span class="sd">    Note that this object is also used to compute the electrostatic field felt by a molecule. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute_general</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L_localization_site&#39;</span><span class="p">,</span> <span class="s1">&#39;L_localization_type&#39;</span><span class="p">,</span> <span class="s1">&#39;multipole_order&#39;</span><span class="p">,</span> <span class="s1">&#39;polarization_order&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute_list_tomerge</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L_charge_order_0&#39;</span><span class="p">,</span> <span class="s1">&#39;L_charge_order_1&#39;</span><span class="p">,</span> <span class="s1">&#39;L_charge_order_2&#39;</span><span class="p">,</span> <span class="s1">&#39;L_polarization_order_1_1&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute_list_special</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L_polarization_exclude&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute_general</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute_list_tomerge</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute_list_special</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">multipole_order</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polarization_order</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">L_localization_site</span> <span class="o">=</span> <span class="s1">&#39;NotProvided&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_localization_type</span> <span class="o">=</span> <span class="s1">&#39;NotProvided&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_charge_order_0</span> <span class="o">=</span> <span class="s1">&#39;NotProvided&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_charge_order_1</span> <span class="o">=</span> <span class="s1">&#39;NotProvided&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_charge_order_2</span> <span class="o">=</span> <span class="s1">&#39;NotProvided&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_polarization_order_1_1</span> <span class="o">=</span> <span class="s1">&#39;NotProvided&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_polarization_exclude</span> <span class="o">=</span> <span class="s1">&#39;NotProvided&#39;</span>
            
        <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Prevent the attribution of undefine object to the class. This help avoiding bad spelling mistakes.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">NotAnOptionError</span><span class="p">(</span><span class="s1">&#39;The name </span><span class="si">%r</span><span class="s1"> is not a valide attribute for the Electrostatic Description object.&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">NotAnOptionError</span><span class="p">(</span><span class="s1">&#39;The name </span><span class="si">%r</span><span class="s1"> is not a valide attribute for the Electrostatic Description object.&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>

            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        
        
<span class="c1">################################################################################################################################# </span>
<span class="c1">#################################################################################################################################    </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">multipole_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [int]  </span>
<span class="sd">        </span>
<span class="sd">        The maximal order of charge distribution description used in this ElectrostaticDescription object. </span>
<span class="sd">        </span>
<span class="sd">        If multipole_order=0, only point charge are used.</span>
<span class="sd">        If multipole_order=1 dipole are also used.</span>
<span class="sd">        If multipole_order=2, quadrupolar moment are also used. </span>
<span class="sd">        </span>
<span class="sd">        This attribute is used to keep track of the maximal multipole order to make esier the writting of the dalton potential input file. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_multipole_order</span><span class="p">)</span>
    
    <span class="nd">@multipole_order</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">multipole_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute ElectrostaticDescription.multipole_order values can only be int.&#39;</span><span class="p">)</span>
        <span class="c1"># logging.info(&#39;Setting the ElectrostaticDescription.L_localization_site  name to %s&#39;, value) # too much print otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_multipole_order</span> <span class="o">=</span> <span class="n">value</span>    
<span class="c1">#################################################################################################################################  </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">polarization_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [int]  </span>
<span class="sd">        </span>
<span class="sd">        The maximal order of polarizability used in this ElectrostaticDescription object. </span>
<span class="sd">        </span>
<span class="sd">        If multipole_order=0, no polarizable molecule are defined. </span>
<span class="sd">        If multipole_order=1 some molecule are polarizable.. </span>
<span class="sd">        </span>
<span class="sd">        This attribute is used to keep track of polarizability to make esier the writting of the dalton potential input file. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        This attribute is not directly related to the QMParameter.pe_order used. It refers to the polarizability of the neighborhood. If the electrostatic scheme used allows to use polarizability but no molecule are polarizable according to their MT electrostatic description, then the result will be same as if QMParameter.pe_order=0 is used. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_polarization_order</span><span class="p">)</span>
    
    <span class="nd">@polarization_order</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">polarization_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute ElectrostaticDescription.polarization_order values can only be int.&#39;</span><span class="p">)</span>
        <span class="c1"># logging.info(&#39;Setting the ElectrostaticDescription.L_localization_site  name to %s&#39;, value) # too much print otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_polarization_order</span> <span class="o">=</span> <span class="n">value</span>    
<span class="c1">################################################################################################################################# </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">L_localization_site</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [list or str]  </span>
<span class="sd">        </span>
<span class="sd">        The space-position of every site needed for the electrostatic description of the molecule. These positions will be used later on by the L_charge_order_0, L_charge_order_1, L_charge_order_2 and L_polarization_order_1_1 attribute. Note that these position are given in the same referential as the molecule position. There are as many element in this list as &#39;site&#39;. However, each &#39;site&#39; can have only point charge value, and or dipole, and or quadrupole moments, or nothing. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        At the initialization, L_localization_site = &#39;NotProvided&#39;. If you do not want to assign any electrostatic description to a molecule type, just do not update any value in the electrostatic_description molecular module function. If L_localization_site = &#39;NotProvided&#39;, Frog will considere this as an empty electrostatic description an will pass this molecule when building the electrostatic environment. </span>
<span class="sd">        </span>
<span class="sd">        However, this way the molecule will not be printed if an .xyz file is generated to keep a track of every configuration. Thus, if you want that a MT has no impact in an electrostatic scheme, but you still want to have it printed in the .xyz file, you can define the L_localization_site attribute, the L_localization_type, an nothing more. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_L_localization_site</span><span class="p">)</span>
    
    <span class="nd">@L_localization_site</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">L_localization_site</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute ElectrostaticDescription.L_localization_site values can only be list or str.&#39;</span><span class="p">)</span>
        <span class="c1"># logging.info(&#39;Setting the ElectrostaticDescription.L_localization_site  name to %s&#39;, value) # too much print otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_L_localization_site</span> <span class="o">=</span> <span class="n">value</span>    
<span class="c1">#################################################################################################################################    </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">L_localization_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [list or str]  </span>
<span class="sd">        </span>
<span class="sd">        The list of the site name associated to each localization site. The length of L_localization_site and L_localization_type should be the same. The name attributed to each site are arbitrary and have no incidence on the QM calculation. They are used if the .xyz electrostatic environment should be printed. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_L_localization_type</span><span class="p">)</span>
    
    <span class="nd">@L_localization_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">L_localization_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute ElectrostaticDescription.L_localization_type values can only be list or str.&#39;</span><span class="p">)</span>
        <span class="c1"># logging.info(&#39;Setting the ElectrostaticDescription.L_localization_site  name to %s&#39;, value) # too much print otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_L_localization_type</span> <span class="o">=</span> <span class="n">value</span>    
<span class="c1">############################################################################################################################### </span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">L_charge_order_0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [list or str]  </span>
<span class="sd">        </span>
<span class="sd">        If defined to a list, means that some site defined in L_localization_site are associated to a point charge. In this case, L_charge_order_0 defines the site number and the charge of every point charge. </span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        L_charge_order_0 = [[2, -1.1128], [3, 0.5564], [4, 0.5564]]</span>
<span class="sd">        </span>
<span class="sd">        3 point charge are defined. The first point charge is negativly charged, q=-1.1128 e, and is located at the 2nd element of L_localization_site. The 2nd and 3rd point charge are positivly charged, q=0.5564 e, and are located at the 3rd and 4th element of the L_localization_site. Here, the first element of L_localization_site has no point charge attached. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        The assignement of the charge with the site location starts at 1 instead of 0. </span>
<span class="sd">        </span>
<span class="sd">        L_charge_order_0 = [[1, q1], [2, q2]...]</span>
<span class="sd">        </span>
<span class="sd">        Assigns to the first site of L_localization_site the charge q1, to the 2th site the charge q2 ect...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_L_charge_order_0</span><span class="p">)</span>
    
    <span class="nd">@L_charge_order_0</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">L_charge_order_0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute ElectrostaticDescription.L_charge_order_0 values can only be list or str.&#39;</span><span class="p">)</span>
        <span class="c1"># logging.info(&#39;Setting the ElectrostaticDescription.L_localization_site  name to %s&#39;, value) # too much print otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_L_charge_order_0</span> <span class="o">=</span> <span class="n">value</span>    
<span class="c1">###############################################################################################################################</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">L_charge_order_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [list or str]  </span>
<span class="sd">        </span>
<span class="sd">        If defined to a list, means that some site defined in L_localization_site are associated to a dipole moment. In this case, L_charge_order_1 defines the site number and the dipole vector. </span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        L_charge_order_1 = [[1, [-0.25, -0.25, -0.25]]] </span>
<span class="sd">        </span>
<span class="sd">        1 dipole is defined at the position L_localization_site[0] with a dipole moment [-0.25, -0.25, -0.25] in a.u. .</span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        The assignement of the dipole with the site location starts at 1 instead of 0. </span>
<span class="sd">        </span>
<span class="sd">        L_charge_order_1 = [[1, vec1], [2, vec2]...]</span>
<span class="sd">        </span>
<span class="sd">        Assigns to the first site of L_localization_site the dipole moment vec1, to the 2th site the dipole moment vec2 ect...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_L_charge_order_1</span><span class="p">)</span>
    
    <span class="nd">@L_charge_order_1</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">L_charge_order_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute ElectrostaticDescription.L_charge_order_1 values can only be list or str.&#39;</span><span class="p">)</span>
        <span class="c1"># logging.info(&#39;Setting the ElectrostaticDescription.L_localization_site  name to %s&#39;, value) # too much print otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_L_charge_order_1</span> <span class="o">=</span> <span class="n">value</span>    
<span class="c1">###############################################################################################################################</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">L_charge_order_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [list or str]  </span>
<span class="sd">       </span>
<span class="sd">        If defined to a list, means that some site defined in L_localization_site are associated to a quadrupole moment. In this case, L_charge_order_2 defines the site number and the quadrupole value. The quadrupole have to be symetric: they are define only by the [xx xy xz yy yz zz] values.</span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        L_charge_order_2 =  [[1, [-0.25, -0.25, -0.25, -0.25, -0.25, -0.25]]] </span>
<span class="sd">        </span>
<span class="sd">        1 quadrupole is defined at the position L_localization_site[0] with a quadrupole value moment [xx xy xz yy yz zz] = [-0.25, -0.25, -0.25, -0.25, -0.25, -0.25] in a.u. .</span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        The assignement of the quadrupole with the site location starts at 1 instead of 0. </span>
<span class="sd">        </span>
<span class="sd">        L_charge_order_2 = [[1, qua1], [2, qua2]...]</span>
<span class="sd">        </span>
<span class="sd">        Assigns to the first site of L_localization_site the quadrupole qua1, to the 2th site the quadrupole qua2 ect...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_L_charge_order_2</span><span class="p">)</span>
    
    <span class="nd">@L_charge_order_2</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">L_charge_order_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute ElectrostaticDescription.L_charge_order_2 values can only be list or str.&#39;</span><span class="p">)</span>
        <span class="c1"># logging.info(&#39;Setting the ElectrostaticDescription.L_localization_site  name to %s&#39;, value) # too much print otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_L_charge_order_2</span> <span class="o">=</span> <span class="n">value</span>    
<span class="c1">###############################################################################################################################</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">L_polarization_order_1_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [list or str]  </span>
<span class="sd">        </span>
<span class="sd">        If defined to a list, means that some site defined in L_localization_site are associated to a polarizable dipole. In this case, L_polarization_order_1_1 defines the site number and the polarizability of these site. The polarizability have to be symetric: they are define only by the [xx xy xz yy yz zz] values.</span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        L_polarization_order_1_1 =  [[1, [-0.25, -0.25, -0.25, -0.25, -0.25, -0.25]]] </span>
<span class="sd">        </span>
<span class="sd">        1 polarizable site is defined at the position L_localization_site[0] with a polarizability [xx xy xz yy yz zz] = [-0.25, -0.25, -0.25, -0.25, -0.25, -0.25] in a.u. . It means that a dipole moment can be created at the first site location by the neighborhood using this polarizability value. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        The assignement of the polarizability with the site location starts at 1 instead of 0. </span>
<span class="sd">        </span>
<span class="sd">        L_charge_order_2 = [[1, alpha1], [2, alpha2]...]</span>
<span class="sd">        </span>
<span class="sd">        Assigns to the first site of L_localization_site the polarizability alpha1, to the 2th site the polarizability alpha2 ect...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_L_polarization_order_1_1</span><span class="p">)</span>
    
    <span class="nd">@L_polarization_order_1_1</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">L_polarization_order_1_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute ElectrostaticDescription.L_polarization_order_1_1 values can only be list or str.&#39;</span><span class="p">)</span>
        <span class="c1"># logging.info(&#39;Setting the ElectrostaticDescription.L_localization_site  name to %s&#39;, value) # too much print otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_L_polarization_order_1_1</span> <span class="o">=</span> <span class="n">value</span>    
<span class="c1">###############################################################################################################################</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">L_polarization_exclude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Type** [list or str]  </span>
<span class="sd">        </span>
<span class="sd">        Defines for some dipole a list of dipole from which they cannot be polarized.  </span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        </span>
<span class="sd">        L_polarization_exclude = [[1, [2, 3, 4]]] </span>
<span class="sd">        </span>
<span class="sd">        The dipole located at the site 1 (position L_localization_site[0]) cannot be polarized by the dipole localted at the site 2, 3 and 4. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        The assignement of this list with the site location starts at 1 instead of 0, as the similar attribute of the Electrostatic Description object. </span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        This behavior has not been extensively tested, please read the relative part on the Dalton manual (polarizable electrostatic emmebedding, and the exclude partern).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_L_polarization_exclude</span><span class="p">)</span>
    
    <span class="nd">@L_polarization_exclude</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">L_polarization_exclude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value and avoid bad type or impossible values.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The attribute ElectrostaticDescription.L_polarization_exclude values can only be list or str.&#39;</span><span class="p">)</span>
        <span class="c1"># logging.info(&#39;Setting the ElectrostaticDescription.L_localization_site  name to %s&#39;, value) # too much print otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_L_polarization_exclude</span> <span class="o">=</span> <span class="n">value</span>    
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
<div class="viewcode-block" id="ElectrostaticDescription.rescale_values">
<a class="viewcode-back" href="../../Frog.html#Frog.class_OpticalParameter.ElectrostaticDescription.rescale_values">[docs]</a>
    <span class="k">def</span> <span class="nf">rescale_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rescaling_charges</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L_charge_order_0</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="c1"># print(self.L_charge_order_0, rescaling_charges)</span>
            <span class="k">for</span> <span class="n">trotter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L_charge_order_0</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">L_charge_order_0</span><span class="p">[</span><span class="n">trotter</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_charge_order_0</span><span class="p">[</span><span class="n">trotter</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rescaling_charges</span>
            <span class="c1"># print(self.L_charge_order_0)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multipole_order</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: noting done here in that case, code to write.&#39;</span><span class="p">)</span></div>


<span class="c1">#################################################################################################################################</span>
    
<div class="viewcode-block" id="ElectrostaticDescription.merge_mol">
<a class="viewcode-back" href="../../Frog.html#Frog.class_OpticalParameter.ElectrostaticDescription.merge_mol">[docs]</a>
    <span class="k">def</span> <span class="nf">merge_mol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">otherself</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Merge the electrostatic description of otherself with self. First update the maximal multipole order and polarizable order and then merge the list of charge/dipole/quadrupole/polarizability description. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L_localization_site</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> <span class="c1">#meaning self is empty</span>
            <span class="k">for</span> <span class="n">nameattribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameattribute</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">otherself</span><span class="p">,</span> <span class="n">nameattribute</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multipole_order</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multipole_order</span><span class="p">,</span> <span class="n">otherself</span><span class="o">.</span><span class="n">multipole_order</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">polarization_order</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polarization_order</span><span class="p">,</span> <span class="n">otherself</span><span class="o">.</span><span class="n">polarization_order</span><span class="p">)</span>

            <span class="n">shift_position</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L_localization_type</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">trotter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">otherself</span><span class="o">.</span><span class="n">L_localization_type</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">L_localization_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">otherself</span><span class="o">.</span><span class="n">L_localization_type</span><span class="p">[</span><span class="n">trotter</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">L_localization_site</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">otherself</span><span class="o">.</span><span class="n">L_localization_site</span><span class="p">[</span><span class="n">trotter</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">attribute_tomerge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_attribute_list_tomerge</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">otherself</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">),</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">trotter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">otherself</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">)),</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="nb">getattr</span><span class="p">(</span><span class="n">otherself</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">)[</span><span class="n">trotter</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>  <span class="nb">getattr</span><span class="p">(</span><span class="n">otherself</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">)[</span><span class="n">trotter</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift_position</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">),</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">trotter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">otherself</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">)),</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">otherself</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">)[</span><span class="n">trotter</span><span class="p">])</span>    
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">otherself</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">))</span>


            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarization_order</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">attribute_tomerge</span> <span class="o">=</span> <span class="s1">&#39;L_polarization_exclude&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">otherself</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">),</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">trotter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">otherself</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">)),</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="nb">getattr</span><span class="p">(</span><span class="n">otherself</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">)[</span><span class="n">trotter</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>  <span class="nb">getattr</span><span class="p">(</span><span class="n">otherself</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">)[</span><span class="n">trotter</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift_position</span>
                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">otherself</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">)[</span><span class="n">trotter</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="nb">getattr</span><span class="p">(</span><span class="n">otherself</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">)[</span><span class="n">trotter</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">otherself</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">)[</span><span class="n">trotter</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">item</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift_position</span>

                    
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">),</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">trotter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">otherself</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">)),</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">otherself</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">)[</span><span class="n">trotter</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">otherself</span><span class="p">,</span> <span class="n">attribute_tomerge</span><span class="p">))</span></div>
</div>

    
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../index.html">
    <img class="logo" src="../../_static/frog_logo.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Installation/how_to_install_frog.html">1. How to Install Frog?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Tutorials/tutorial_index.html">2. Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GlobalParameter/gp_index.html">3. Global Parameter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MoleculeType/mt_index.html">4. Molecule Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Diagram/diagram_index.html">5. Diagram</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../OpticalAnalysis/optical_analysis_index.html">6. Optical Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Frog.html">7. Frog package</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Guillaume Le Breton.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
    </div>

    

    
  </body>
</html>