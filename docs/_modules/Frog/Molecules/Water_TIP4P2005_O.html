<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Frog.Molecules.Water_TIP4P2005_O &#8212; Frog 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=039e1c02" />
    <link rel="stylesheet" type="text/css" href="../../../_static/_static/css/s4defs-roles.css" />
    <script src="../../../_static/documentation_options.js?v=8d563738"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for Frog.Molecules.Water_TIP4P2005_O</h1><div class="highlight"><pre>
<span></span><span class="c1">##############################################################################</span>
<span class="c1">#                                                                            #</span>
<span class="c1">#    FROG: FROm molecular dynamics to second harmonic Generation             #</span>
<span class="c1">#    Copyright (C) 2024                                                      #</span>
<span class="c1">#    Author list                                                             #</span>
<span class="c1">#                                                                            #</span>
<span class="c1">#    Guillaume Le Breton                                                     #</span>
<span class="c1">#    Oriane Bonhomme                                                         #</span>
<span class="c1">#    Emmanuel Benichou                                                       #</span>
<span class="c1">#    Claire Loison                                                           #</span>
<span class="c1">#                                                                            # </span>
<span class="c1">#    This program is free software: you can redistribute it and/or modify    #</span>
<span class="c1">#    it under the terms of the GNU General Public License as published by    #</span>
<span class="c1">#    the Free Software Foundation, either version 3 of the License, or       #</span>
<span class="c1">#    (at your option) any later version.                                     #</span>
<span class="c1">#                                                                            #</span>
<span class="c1">#    This program is distributed in the hope that it will be useful,         #</span>
<span class="c1">#    but WITHOUT ANY WARRANTY; without even the implied warranty of          #</span>
<span class="c1">#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the           #</span>
<span class="c1">#    GNU General Public License for more details.                            #</span>
<span class="c1">#                                                                            #</span>
<span class="c1">#    You should have received a copy of the GNU General Public License       # </span>
<span class="c1">#    along with this program.  If not, see &lt;https://www.gnu.org/licenses/    #</span>
<span class="c1">#                                                                            #</span>
<span class="c1">##############################################################################</span>



<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">Frog.geometry_manager</span> <span class="k">as</span> <span class="nn">geometry_manager</span>
<span class="kn">import</span> <span class="nn">Frog.toolbox</span> <span class="k">as</span> <span class="nn">toolbox</span>


<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>

<div class="viewcode-block" id="typical_geometry">
<a class="viewcode-back" href="../../../Frog.Molecules.html#Frog.Molecules.Water_TIP4P2005_O.typical_geometry">[docs]</a>
<span class="k">def</span> <span class="nf">typical_geometry</span><span class="p">():</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="mf">104.52</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
    <span class="n">d</span> <span class="o">=</span> <span class="mf">0.9572</span>
    <span class="n">L_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="n">d</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span> 
        <span class="p">[</span><span class="n">d</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="n">theta</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="o">-</span><span class="n">theta</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span>
                     <span class="p">])</span>
    <span class="k">return</span><span class="p">(</span><span class="n">L_pos</span><span class="p">)</span></div>

    

<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>

<div class="viewcode-block" id="info_molecule_typical_size">
<a class="viewcode-back" href="../../../Frog.Molecules.html#Frog.Molecules.Water_TIP4P2005_O.info_molecule_typical_size">[docs]</a>
<span class="k">def</span> <span class="nf">info_molecule_typical_size</span><span class="p">():</span>
    <span class="k">return</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span></div>


<div class="viewcode-block" id="info_molecule">
<a class="viewcode-back" href="../../../Frog.Molecules.html#Frog.Molecules.Water_TIP4P2005_O.info_molecule">[docs]</a>
<span class="k">def</span> <span class="nf">info_molecule</span><span class="p">(</span><span class="n">smparameter</span><span class="p">):</span>
    
    <span class="c1">#basic geometric information</span>
    <span class="n">smparameter</span><span class="o">.</span><span class="n">name_mt</span> <span class="o">=</span> <span class="s1">&#39;Water_TIP4P2005_O&#39;</span>
    <span class="n">smparameter</span><span class="o">.</span><span class="n">nbr_atom</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">smparameter</span><span class="o">.</span><span class="n">L_type_atom</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">]</span>
    <span class="n">smparameter</span><span class="o">.</span><span class="n">size_typical_molecule</span> <span class="o">=</span> <span class="n">info_molecule_typical_size</span><span class="p">()</span>  <span class="c1">#in Angstrom </span>
    <span class="n">smparameter</span><span class="o">.</span><span class="n">max_distance_atom</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Ref&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> 
    <span class="c1"># Informations relative to the other fct defined</span>
    <span class="n">smparameter</span><span class="o">.</span><span class="n">d_molecular_orientation</span> <span class="o">=</span> <span class="mi">3</span>
    
    <span class="k">return</span><span class="p">(</span><span class="n">smparameter</span><span class="p">)</span></div>


<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>

<div class="viewcode-block" id="compute_mean_position">
<a class="viewcode-back" href="../../../Frog.Molecules.html#Frog.Molecules.Water_TIP4P2005_O.compute_mean_position">[docs]</a>
<span class="k">def</span> <span class="nf">compute_mean_position</span><span class="p">(</span><span class="n">L_pos</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Define how to compute the &#39;&#39;mean position&#39;&#39; of the molecule given its position.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#vec_dipole = (L_pos[1]-L_pos[0])+(L_pos[2]-L_pos[0]) # ref centered around the oxygen atom</span>
    <span class="c1">#vec_dipole = vec_dipole/np.sqrt(np.sum(vec_dipole**2))</span>
    <span class="c1">#position_dipole = L_pos[0] + 0.1546*vec_dipole</span>
    <span class="k">return</span><span class="p">(</span><span class="n">L_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>

<div class="viewcode-block" id="compute_molecular_orientation">
<a class="viewcode-back" href="../../../Frog.Molecules.html#Frog.Molecules.Water_TIP4P2005_O.compute_molecular_orientation">[docs]</a>
<span class="k">def</span> <span class="nf">compute_molecular_orientation</span><span class="p">(</span><span class="n">L_pos</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Define how to compute the &#39;&#39;molecular orientation&#39;&#39; of the molecule given its position. Here its the projection of the dipole moment on the laboratory axis. </span>
<span class="sd">    WARNING: THIS SHOULD RETURN VALUE BETWEEN -1 AND 1. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">vec_dipole</span> <span class="o">=</span> <span class="p">(</span><span class="n">L_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">L_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="p">(</span><span class="n">L_pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">L_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># ref centered around the oxygen atom</span>
    <span class="n">vec_dipole</span> <span class="o">=</span> <span class="n">vec_dipole</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vec_dipole</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">vec_dipole</span><span class="p">)</span></div>


<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>


<div class="viewcode-block" id="compute_hbonds">
<a class="viewcode-back" href="../../../Frog.Molecules.html#Frog.Molecules.Water_TIP4P2005_O.compute_hbonds">[docs]</a>
<span class="k">def</span> <span class="nf">compute_hbonds</span><span class="p">(</span><span class="n">L_target</span><span class="p">,</span> <span class="n">name_partner</span><span class="p">,</span> <span class="n">L_partner</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Define how to compute the &#39;&#39;hbonds&#39;&#39; of this molecule type with a partner molecule type. The definition should depend on the partner molecule.  </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">name_partner</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Water_TIP4P2005_O&#39;</span><span class="p">]:</span>
        <span class="c1">#[length O---O max, angle OH---O max] = parameter</span>
        <span class="k">if</span> <span class="n">info</span><span class="p">:</span> <span class="c1"># Here is asked the maximal distance to consider an hbonds</span>
            <span class="k">return</span><span class="p">(</span><span class="n">parameter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="n">L_H</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">L_target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">L_partner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">parameter</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="c1">#Does the target molecule own an hbonds?</span>
            <span class="k">for</span> <span class="n">H_partner</span> <span class="ow">in</span> <span class="n">L_H</span><span class="p">:</span> 
                <span class="n">L_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">L_partner</span><span class="p">[</span><span class="n">H_partner</span><span class="p">],</span> <span class="n">L_target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">L_partner</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="c1">#O of the target, HO of the partner</span>
                <span class="n">angle</span> <span class="o">=</span> <span class="n">geometry_manager</span><span class="o">.</span><span class="n">compute_angle_3_atoms</span><span class="p">(</span><span class="n">L_angle</span><span class="p">)</span> <span class="c1"># the angle: O--HO</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">parameter</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="c1"># The target molecule own an hbonds. The partner molecule give an hbonds</span>
                    <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
            <span class="c1">#Does the target molecule give an hbonds?</span>
            <span class="k">for</span> <span class="n">H_target</span> <span class="ow">in</span> <span class="n">L_H</span><span class="p">:</span> 
                <span class="n">L_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">L_target</span><span class="p">[</span><span class="n">H_target</span><span class="p">],</span> <span class="n">L_partner</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">L_target</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="c1">#O of the partner, HO of the target</span>
                <span class="n">angle</span> <span class="o">=</span> <span class="n">geometry_manager</span><span class="o">.</span><span class="n">compute_angle_3_atoms</span><span class="p">(</span><span class="n">L_angle</span><span class="p">)</span> <span class="c1"># the angle: OH--H</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">parameter</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="c1"># The target molecule give an hbonds. The partner molecule own an hbonds</span>
                    <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="c1"># If the run arrives at this point, it means that no hbonds between the target and the partner molecules have been found</span>
        <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
    <span class="k">elif</span> <span class="n">name_partner</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Methanol_OPLSAA&#39;</span><span class="p">,</span> <span class="s1">&#39;Ethanol_OPLSAA&#39;</span><span class="p">]:</span>
        <span class="c1">#[length O---O max, angle OH---O max] = parameter</span>
        <span class="k">if</span> <span class="n">info</span><span class="p">:</span> <span class="c1"># Here is asked the maximal distance to consider an hbonds</span>
            <span class="k">return</span><span class="p">(</span><span class="n">parameter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
        
        <span class="n">L_H_water</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">L_H_alcool</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">L_target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">L_partner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">parameter</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="c1">#Does the target molecule own an hbonds?</span>
            <span class="k">for</span> <span class="n">H_partner</span> <span class="ow">in</span> <span class="n">L_H_alcool</span><span class="p">:</span> 
                <span class="n">L_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">L_partner</span><span class="p">[</span><span class="n">H_partner</span><span class="p">],</span> <span class="n">L_target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">L_partner</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">angle</span> <span class="o">=</span> <span class="n">geometry_manager</span><span class="o">.</span><span class="n">compute_angle_3_atoms</span><span class="p">(</span><span class="n">L_angle</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">parameter</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="c1"># The target molecule own an hbonds. The partner molecule give an hbonds</span>
                    <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
            <span class="c1">#Does the target molecule give an hbonds?</span>
            <span class="k">for</span> <span class="n">H_target</span> <span class="ow">in</span> <span class="n">L_H_water</span><span class="p">:</span> 
                <span class="n">L_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">L_target</span><span class="p">[</span><span class="n">H_target</span><span class="p">],</span> <span class="n">L_target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">L_partner</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">angle</span> <span class="o">=</span> <span class="n">geometry_manager</span><span class="o">.</span><span class="n">compute_angle_3_atoms</span><span class="p">(</span><span class="n">L_angle</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">parameter</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="c1"># The target molecule give an hbonds. The partner molecule own an hbonds</span>
                    <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
            <span class="c1"># No hbonds between the target and the partner molecules</span>
        <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: The molecule type WATER_TIP4P2005_O does not know how to compute hbonds with the molecule type: &#39;</span> <span class="o">+</span> <span class="n">name_partner</span> <span class="o">+</span>  <span class="s1">&#39;.&#39;</span><span class="p">)</span> 
        <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

    
    
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>

<div class="viewcode-block" id="compute_rotational_matrix">
<a class="viewcode-back" href="../../../Frog.Molecules.html#Frog.Molecules.Water_TIP4P2005_O.compute_rotational_matrix">[docs]</a>
<span class="k">def</span> <span class="nf">compute_rotational_matrix</span><span class="p">(</span><span class="n">L_pos</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Define the matrix to go from the Molecular to the Laboratory frame: X_{lab} = Rot_matrix * X_{mol}</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">vec_H1</span> <span class="o">=</span> <span class="n">L_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">L_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">vec_H2</span> <span class="o">=</span> <span class="n">L_pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">L_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">x_mol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vec_H1</span><span class="o">-</span><span class="n">vec_H2</span><span class="p">)</span> 
    <span class="n">x_mol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_mol</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x_mol</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span> <span class="c1"># unit vector</span>
    
    <span class="n">z_mol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vec_H1</span><span class="o">+</span><span class="n">vec_H2</span><span class="p">)</span>
    <span class="n">z_mol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z_mol</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">z_mol</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span> <span class="c1"># unit vector</span>
    
    <span class="n">y_mol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">z_mol</span><span class="p">,</span> <span class="n">x_mol</span><span class="p">)</span> <span class="c1"># unit vector</span>
    <span class="n">y_mol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_mol</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y_mol</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span> <span class="c1"># unit vector</span>
    
    <span class="n">Rot_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x_mol</span><span class="p">,</span> <span class="n">y_mol</span><span class="p">,</span> <span class="n">z_mol</span><span class="p">])</span> <span class="c1"># </span>
    
    <span class="k">return</span><span class="p">(</span><span class="n">Rot_matrix</span><span class="p">)</span></div>

    
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
    
<div class="viewcode-block" id="electrostatic_description">
<a class="viewcode-back" href="../../../Frog.Molecules.html#Frog.Molecules.Water_TIP4P2005_O.electrostatic_description">[docs]</a>
<span class="k">def</span> <span class="nf">electrostatic_description</span><span class="p">(</span><span class="n">pe_order</span><span class="p">,</span> <span class="n">electro_description</span><span class="p">,</span> <span class="n">L_pos</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    
    <span class="n">electro_description</span><span class="o">.</span><span class="n">multipole_order</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">electro_description</span><span class="o">.</span><span class="n">polarization_order</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">L_pos</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">L_pos</span><span class="p">:</span>
        <span class="n">L_pos</span> <span class="o">=</span> <span class="n">typical_geometry</span><span class="p">()</span>
        
    <span class="n">vec_dipole</span> <span class="o">=</span> <span class="p">(</span><span class="n">L_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">L_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="p">(</span><span class="n">L_pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">L_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># ref centered around the oxygen atom</span>
    <span class="n">vec_dipole</span> <span class="o">=</span> <span class="n">vec_dipole</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vec_dipole</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="n">charge_tip4p2005</span> <span class="o">=</span> <span class="n">L_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1546</span><span class="o">*</span><span class="n">vec_dipole</span>
    <span class="n">electro_description</span><span class="o">.</span><span class="n">L_localization_type</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">]</span>
    <span class="n">electro_description</span><span class="o">.</span><span class="n">L_localization_site</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">charge_tip4p2005</span><span class="p">,</span> <span class="n">L_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">L_pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
    <span class="n">electro_description</span><span class="o">.</span><span class="n">L_charge_order_0</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1128</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.5564</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.5564</span><span class="p">]]</span> <span class="c1">#Warning: contrarily to the rest of the code/python uses, the site are label from 1 (no 0!)</span>
    
    <span class="k">if</span> <span class="n">pe_order</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">electro_description</span><span class="o">.</span><span class="n">polarization_order</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#raise Exception(&#39;WARNING: Pe order larger than 0 is not implemented yet for WaterTIP4P/2005!&#39;)</span>
        
    <span class="k">return</span><span class="p">(</span><span class="n">electro_description</span><span class="p">)</span></div>


<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>

<div class="viewcode-block" id="test_electrostatic">
<a class="viewcode-back" href="../../../Frog.Molecules.html#Frog.Molecules.Water_TIP4P2005_O.test_electrostatic">[docs]</a>
<span class="k">def</span> <span class="nf">test_electrostatic</span><span class="p">(</span><span class="n">electro_neigh</span><span class="p">,</span> <span class="n">L_pos</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    
    
    <span class="n">electro_neigh</span><span class="o">.</span><span class="n">multipole_order</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">electro_neigh</span><span class="o">.</span><span class="n">polarization_order</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="n">electro_neigh</span><span class="o">.</span><span class="n">L_localization_type</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">]</span>
    <span class="n">electro_neigh</span><span class="o">.</span><span class="n">L_localization_site</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">10.1</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">3.3</span><span class="p">],</span> <span class="p">[</span><span class="mf">10.1</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">3.3</span><span class="p">],</span> <span class="p">[</span><span class="mf">10.1</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">3.3</span><span class="p">],</span> <span class="p">[</span><span class="mf">10.1</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">3.3</span><span class="p">]]</span>
    <span class="n">electro_neigh</span><span class="o">.</span><span class="n">L_charge_order_0</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">]]</span> <span class="c1">#Warning: contrarily to the rest of the code/python uses, the site are label from 1 (no 0!)</span>
    <span class="n">electro_neigh</span><span class="o">.</span><span class="n">L_charge_order_1</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]]</span>
    <span class="n">electro_neigh</span><span class="o">.</span><span class="n">L_charge_order_2</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">]]]</span>
    <span class="n">electro_neigh</span><span class="o">.</span><span class="n">L_polarization_order_1_1</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">]],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">]]]</span>
    <span class="n">electro_neigh</span><span class="o">.</span><span class="n">L_polarization_exclude</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]]</span>

    <span class="k">return</span><span class="p">(</span><span class="n">electro_neigh</span><span class="p">)</span></div>


<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
    
<div class="viewcode-block" id="qm_target_description">
<a class="viewcode-back" href="../../../Frog.Molecules.html#Frog.Molecules.Water_TIP4P2005_O.qm_target_description">[docs]</a>
<span class="k">def</span> <span class="nf">qm_target_description</span><span class="p">(</span><span class="n">qmparameter</span><span class="p">,</span> <span class="n">qmdescription</span><span class="p">,</span> <span class="n">L_pos</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    TODO</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">qmparameter</span><span class="o">.</span><span class="n">type_basis</span> <span class="o">!=</span> <span class="s1">&#39;Global basis&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: No other way to defined basis have been defined yet for this molecule. Possible value: &lt; Global basis &gt;. We can also defined basis for each atoms (TODO).&#39;</span><span class="p">)</span> 
    
    <span class="n">qmdescription</span><span class="o">.</span><span class="n">L_atom_type</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]]]</span>
 
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">L_pos</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">L_pos</span><span class="p">:</span>
        <span class="n">L_pos</span> <span class="o">=</span> <span class="n">typical_geometry</span><span class="p">()</span>
    
    <span class="n">qmdescription</span><span class="o">.</span><span class="n">L_coordinate</span> <span class="o">=</span> <span class="n">L_pos</span>
    
    <span class="k">return</span><span class="p">(</span><span class="n">qmdescription</span><span class="p">)</span></div>


<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
    

    
    <span class="c1">#L_max_norm = np.zeros(len(L_pos_molecule)) + 2</span>
    <span class="c1">#for atom in range(1, len(L_pos_molecule), 1):</span>
    <span class="c1">#    L_pos_molecule[atom] = md_analysis_module.pbc_condition(L_pos_molecule[0], L_pos_molecule[atom], L_max_norm[atom], L_box)</span>
    
    <span class="c1"># For water: the first and second Hydrogen cannot be distinguish. It is not important for vacuum/bulk calculation but might at interfaces. Therefore, the hydrogen are labeled using their absolute position in the z direction.</span>
    
    <span class="c1">#if L_pos_molecule[1][2] &gt; L_pos_molecule[2][2]:</span>
    <span class="c1">#    return(L_pos_molecule)</span>
    <span class="c1">#else:</span>
    <span class="c1">#    O_cord = np.array(L_pos_molecule[0])</span>
    <span class="c1">#    H1_coord = np.array(L_pos_molecule[2])</span>
    <span class="c1">#    H2_coord = np.array(L_pos_molecule[1])</span>
    <span class="c1">#    return(np.array([O_cord, H1_coord, H2_coord]))    </span>
    
    
    
    
    

<div class="viewcode-block" id="md_parameters">
<a class="viewcode-back" href="../../../Frog.Molecules.html#Frog.Molecules.Water_TIP4P2005_O.md_parameters">[docs]</a>
<span class="k">def</span> <span class="nf">md_parameters</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">LL_molecular_prop_t</span><span class="p">):</span>
    <span class="c1"># The inital beta_ref is given in the molecular referential. First we have to find what is the angle between the molecular referential and the laboratory one. Then, we have to built the euler rotational matrix and apply it to the beta_ref to have the hyperpolarisability on the laboratory frame. </span>
    <span class="c1"># Warning: the Molecular angle should be in radian</span>

    <span class="n">O_cord</span><span class="p">,</span> <span class="n">H1_coord</span><span class="p">,</span> <span class="n">H2_coord</span> <span class="o">=</span> <span class="n">check_molecule_position</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">LL_molecular_prop_t</span><span class="p">[(</span><span class="s1">&#39;box_size&#39;</span><span class="p">)])</span>
    
    <span class="n">vec_H1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">H1_coord</span><span class="o">-</span><span class="n">O_cord</span><span class="p">)</span> <span class="c1"># otherwise the x ans z may be non perpendicular. this is due to the unshake during the MD minimization.</span>
    <span class="n">vec_H2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">H2_coord</span><span class="o">-</span><span class="n">O_cord</span><span class="p">)</span>
    
    <span class="n">N_H1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vec_H1</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">N_H2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vec_H2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># Check if there are some periodic boundary condition problem:</span>
    <span class="n">max_norm</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">N_H1</span> <span class="o">&gt;</span> <span class="n">max_norm</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: PBC condition probleme in the water.py calculation!!!!&#39;</span><span class="p">)</span>
        <span class="n">vec_H1</span> <span class="o">=</span> <span class="n">md_analysis_module</span><span class="o">.</span><span class="n">pbc_condition</span><span class="p">(</span><span class="n">O_cord</span><span class="p">,</span> <span class="n">H1_coord</span><span class="p">,</span> <span class="n">max_norm</span><span class="p">,</span>  <span class="n">LL_molecular_prop_t</span><span class="p">[(</span><span class="s1">&#39;box_size&#39;</span><span class="p">)])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vec_H1</span> <span class="o">=</span> <span class="n">vec_H1</span><span class="o">/</span><span class="n">N_H1</span>
    <span class="k">if</span> <span class="n">N_H2</span> <span class="o">&gt;</span> <span class="n">max_norm</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: PBC condition probleme in the water.py calculation!!!!&#39;</span><span class="p">)</span>
        <span class="n">vec_H2</span> <span class="o">=</span> <span class="n">md_analysis_module</span><span class="o">.</span><span class="n">pbc_condition</span><span class="p">(</span><span class="n">O_cord</span><span class="p">,</span> <span class="n">H2_coord</span><span class="p">,</span> <span class="n">max_norm</span><span class="p">,</span>  <span class="n">LL_molecular_prop_t</span><span class="p">[(</span><span class="s1">&#39;box_size&#39;</span><span class="p">)])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vec_H2</span> <span class="o">=</span> <span class="n">vec_H2</span><span class="o">/</span><span class="n">N_H2</span>
    
    <span class="c1">#print(vec_H1, vec_H2)</span>
    <span class="n">x_mol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vec_H1</span><span class="o">-</span><span class="n">vec_H2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x_mol</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">vec_H1</span><span class="p">,</span> <span class="n">vec_H2</span><span class="p">,</span> <span class="n">O_cord</span><span class="p">,</span> <span class="n">H1_coord</span><span class="p">,</span> <span class="n">H2_coord</span><span class="p">)</span>    
    <span class="n">x_mol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_mol</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x_mol</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span> <span class="c1"># unit vector</span>
    
    <span class="n">z_mol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vec_H1</span><span class="o">+</span><span class="n">vec_H2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">z_mol</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">vec_H1</span><span class="p">,</span> <span class="n">vec_H2</span><span class="p">,</span> <span class="n">O_cord</span><span class="p">,</span> <span class="n">H1_coord</span><span class="p">,</span> <span class="n">H2_coord</span><span class="p">)</span>
    <span class="n">z_mol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z_mol</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">z_mol</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span> <span class="c1"># unit vector</span>
    
    <span class="n">y_mol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">z_mol</span><span class="p">,</span> <span class="n">x_mol</span><span class="p">)</span> <span class="c1"># unit vector</span>
    <span class="n">y_mol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_mol</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y_mol</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span> <span class="c1"># unit vector</span>
    
    <span class="c1">#print(np.dot(x_mol, y_mol), np.dot(x_mol, z_mol), np.dot(z_mol, y_mol))</span>
    <span class="c1"># euler angle to pass from the molecular to the lab frame:</span>
    <span class="c1"># theta = angle between the dipole moment (z) and the lab Z axis in rad</span>
    
    <span class="n">molecular_angle_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">z_mol</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">molecular_angle_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">z_mol</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">molecular_angle_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">z_mol</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    
    
    <span class="n">mean_position</span> <span class="o">=</span> <span class="n">O_cord</span>
    
    <span class="c1">#print(&#39;x: &#39;, x_mol, &#39;\n y: &#39;, y_mol, &#39;\n z: &#39;, z_mol, &#39;\n&#39;) </span>
    <span class="n">L_molecular_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">molecular_angle_x</span><span class="p">,</span> <span class="n">molecular_angle_y</span><span class="p">,</span> <span class="n">molecular_angle_z</span><span class="p">])</span>
    <span class="c1">#print(mean_position, &#39;value:&#39;, z_mol[2], &#39;angle:&#39;, L_molecular_angle[2]*180/np.pi)</span>
    <span class="n">base_changement</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x_mol</span><span class="p">,</span> <span class="n">y_mol</span><span class="p">,</span> <span class="n">z_mol</span><span class="p">])</span>
    <span class="c1">#print(base_changement)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">mean_position</span><span class="p">,</span> <span class="n">L_molecular_angle</span><span class="p">,</span> <span class="n">base_changement</span><span class="p">)</span></div>


<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>

<div class="viewcode-block" id="check_molecule_position">
<a class="viewcode-back" href="../../../Frog.Molecules.html#Frog.Molecules.Water_TIP4P2005_O.check_molecule_position">[docs]</a>
<span class="k">def</span> <span class="nf">check_molecule_position</span><span class="p">(</span><span class="n">L_pos_molecule</span><span class="p">,</span> <span class="n">L_box</span><span class="p">):</span>
    
    <span class="c1"># check that their are no PBC problems within the molecule. The L_max_norm array is the parameters to tune to set the maximal accepted distance between the first atom and the others - distance given in the same unit as the molecular position. If the distance btween one atom and the first one is larger than the accetped value, the program will try to reduce this distance by using PBC condition.</span>
    
    <span class="n">L_max_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">L_pos_molecule</span><span class="p">))</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">L_pos_molecule</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">L_pos_molecule</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="n">md_analysis_module</span><span class="o">.</span><span class="n">pbc_condition</span><span class="p">(</span><span class="n">L_pos_molecule</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">L_pos_molecule</span><span class="p">[</span><span class="n">atom</span><span class="p">],</span> <span class="n">L_max_norm</span><span class="p">[</span><span class="n">atom</span><span class="p">],</span> <span class="n">L_box</span><span class="p">)</span>
    
    <span class="c1"># For water: the first and second Hydrogen cannot be distinguish. It is not important for vacuum/bulk calculation but might at interfaces. Therefore, the hydrogen are labeled using their absolute position in the z direction.</span>
    
    <span class="k">if</span> <span class="n">L_pos_molecule</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">L_pos_molecule</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">L_pos_molecule</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">O_cord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">L_pos_molecule</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">H1_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">L_pos_molecule</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">H2_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">L_pos_molecule</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">O_cord</span><span class="p">,</span> <span class="n">H1_coord</span><span class="p">,</span> <span class="n">H2_coord</span><span class="p">]))</span></div>

    


<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>
<span class="c1">#################################################################################################################################</span>

<div class="viewcode-block" id="dalton_input_parameters">
<a class="viewcode-back" href="../../../Frog.Molecules.html#Frog.Molecules.Water_TIP4P2005_O.dalton_input_parameters">[docs]</a>
<span class="k">def</span> <span class="nf">dalton_input_parameters</span><span class="p">(</span><span class="n">L_pos_molecule</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="n">LL_molecule</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">LL_molecule</span><span class="p">[(</span><span class="s1">&#39;L_atomtype_name&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">]</span>
    <span class="n">LL_molecule</span><span class="p">[(</span><span class="s1">&#39;nbr_atomtype&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">LL_molecule</span><span class="p">[(</span><span class="s1">&#39;L_atomtype_name&#39;</span><span class="p">)])</span>
    <span class="n">LL_molecule</span><span class="p">[(</span><span class="s1">&#39;L_charge&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">LL_molecule</span><span class="p">[(</span><span class="s1">&#39;L_nbr_atom_per_atomtype&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">L_pos_molecule</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#tip4p/2005: OH  = 0.9572 Angstrom </span>
        <span class="c1">#            HOH =  104.52 degree (to convert in rad for numpy)</span>
        <span class="c1">#H = [+ or - np.sin(angle/2)*d, 0, np.cos(angle/2)]</span>
        <span class="n">LL_molecule</span><span class="p">[(</span><span class="s1">&#39;L_pos_atom&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]],</span> 
                                       <span class="p">[[</span><span class="mf">0.7570</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.6121</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.7570</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.6121</span><span class="p">]]]</span>
                                         
    <span class="k">else</span><span class="p">:</span>
        <span class="n">LL_molecule</span><span class="p">[(</span><span class="s1">&#39;L_pos_atom&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[[</span><span class="n">L_pos_molecule</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> 
                                       <span class="p">[</span><span class="n">L_pos_molecule</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">L_pos_molecule</span><span class="p">[</span><span class="mi">2</span><span class="p">]]]</span>
    <span class="k">return</span><span class="p">(</span><span class="n">LL_molecule</span><span class="p">)</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../../index.html">
    <img class="logo" src="../../../_static/frog_logo.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Installation/how_to_install_frog.html">1. How to Install Frog?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tutorials/tutorial_index.html">2. Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../GlobalParameter/gp_index.html">3. Global Parameter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../MoleculeType/mt_index.html">4. Molecule Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Diagram/diagram_index.html">5. Diagram</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../OpticalAnalysis/optical_analysis_index.html">6. Optical Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Frog.html">7. Frog package</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Guillaume Le Breton.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
    </div>

    

    
  </body>
</html>